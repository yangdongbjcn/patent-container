"use strict";function ReedSolomon(t){this.logger=null,this.n_ec_bytes=t,this.n_degree_max=2*t,this.syndroms=[],this.gen_poly=null,this.initGaloisTables()}function QRDecode(){this.image=null,this.imageTop=0,this.imageBottom=0,this.imageLeft=0,this.imageRight=0,this.nModules=0,this.moduleSize=0,this.version=0,this.functionalGrade=0,this.ECLevel=0,this.mask=0,this.maskPattern=[],this.nBlockEcWords=0,this.blockIndices=[],this.blockDataLengths=[]}function QREncode(){this.image=null,this.nModules=0,this.version=0,this.functionalGrade=0,this.ECLevel=0,this.mask=0,this.maskPattern=[],this.nDataCodewords=0,this.nBlockEcWords=0,this.blockIndices=[],this.blockDataLengths=[]}var QRBase={MODE:{Numeric:1,AlphaNumeric:2,EightBit:4,Terminator:0},ERROR_CORRECTION_LEVEL:{L:1,M:0,Q:3,H:2},errorThrow:function(t){if(!this._isError){if(!this._errorThrow)throw t;this._errorThrow(t),this._isError=!0}},setBlocks:function(t){var e,i,r,o,s,n,a,h=this.nCodewords[t.version],d=this.nECCodewords[t.version][t.ECLevel],u=this.ECBlocks[t.version][t.ECLevel],l=0;for(t.nDataCodewords=h-d,1===u.length?(i=u[0],r=0,e=i,o=t.nDataCodewords/e,s=0):(i=u[0],r=u[1],e=i+r,o=Math.floor(t.nDataCodewords/e),s=o+1),t.nBlockEcWords=d/e,t.blockDataLengths=[],a=0;i>a;a++)t.blockDataLengths[a]=o;for(a=i;e>a;a++)t.blockDataLengths[a]=s;for(t.blockIndices=[],a=0;e>a;a++)t.blockIndices[a]=[];for(n=0;o>n;n++)for(a=0;e>a;a++)t.blockIndices[a].push(l),l++;for(a=i;e>a;a++)t.blockIndices[a].push(l),l++;for(n=0;n<t.nBlockEcWords;n++)for(a=0;e>a;a++)t.blockIndices[a].push(l),l++},setFunctionalPattern:function(t){function e(t,e,i,r,o){var s,n;for(s=e;e+r>s;s++)for(n=i;i+o>n;n++)t.functionalPattern[s][n]=!0}function i(t,i){var r,o,s=i.alignmentPatterns[t.version].length;for(r=0;s>r;r++)for(o=0;s>o;o++)0===r&&0===o||0===r&&o===s-1||r===s-1&&0===o||e(t,i.alignmentPatterns[t.version][r]-2,i.alignmentPatterns[t.version][o]-2,5,5)}t.functionalPattern=[];var r,o;for(r=0;r<t.nModules;r++)for(t.functionalPattern[r]=[],o=0;o<t.nModules;o++)t.functionalPattern[r][o]=!1;e(t,0,0,9,9),e(t,t.nModules-8,0,8,9),e(t,0,t.nModules-8,9,8),e(t,8,6,t.nModules-8-8,1),e(t,6,8,1,t.nModules-8-8),i(t,this),t.version>=7&&(e(t,0,t.nModules-11,6,3),e(t,t.nModules-11,0,3,6))},nCountBits:function(t,e){return t===this.MODE.EightBit?10>e?8:16:t===this.MODE.AlphaNumeric?10>e?9:27>e?11:13:t===this.MODE.Numeric?10>e?10:27>e?12:14:void this.errorThrow("Internal error: Unknown mode: "+t)},nModulesFromVersion:function(t){return 17+4*t},unicodeToUtf8:function(t){var e,i,r="",o=t.length;for(e=0;o>e;e++)i=t.charCodeAt(e),i>=1&&127>=i?r+=t.charAt(e):i>2047?(r+=String.fromCharCode(224|i>>12&15),r+=String.fromCharCode(128|i>>6&63),r+=String.fromCharCode(128|i>>0&63)):(r+=String.fromCharCode(192|i>>6&31),r+=String.fromCharCode(128|i>>0&63));return r},utf8Tounicode:function(t){for(var e,i,r,o,s="",n=t.length,a=0;n>a;)i=t.charCodeAt(a++),e=i>>4,7>=e?s+=t.charAt(a-1):12===e||13===e?(r=t.charCodeAt(a++),s+=String.fromCharCode((31&i)<<6|63&r)):14===e&&(r=t.charCodeAt(a++),o=t.charCodeAt(a++),s+=String.fromCharCode((15&i)<<12|(63&r)<<6|(63&o)<<0));return s},setErrorThrow:function(t){"function"==typeof t&&(this._errorThrow=t)},alignmentPatterns:[null,[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],versionInfo:[null,null,null,null,null,null,null,31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017],formatInfo:[21522,20773,24188,23371,17913,16590,20375,19104,30660,29427,32170,30877,26159,25368,27713,26998,5769,5054,7399,6608,1890,597,3340,2107,13663,12392,16177,14854,9396,8579,11994,11245],nCodewords:[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706],nECCodewords:[null,[10,7,17,13],[16,10,28,22],[26,15,44,36],[36,20,64,52],[48,26,88,72],[64,36,112,96],[72,40,130,108],[88,48,156,132],[110,60,192,160],[130,72,224,192],[150,80,264,224],[176,96,308,260],[198,104,352,288],[216,120,384,320],[240,132,432,360],[280,144,480,408],[308,168,532,448],[338,180,588,504],[364,196,650,546],[416,224,700,600],[442,224,750,644],[476,252,816,690],[504,270,900,750],[560,300,960,810],[588,312,1050,870],[644,336,1110,952],[700,360,1200,1020],[728,390,1260,1050],[784,420,1350,1140],[812,450,1440,1200],[868,480,1530,1290],[924,510,1620,1350],[980,540,1710,1440],[1036,570,1800,1530],[1064,570,1890,1590],[1120,600,1980,1680],[1204,630,2100,1770],[1260,660,2220,1860],[1316,720,2310,1950],[1372,750,2430,2040]],ECBlocks:[[],[[1],[1],[1],[1]],[[1],[1],[1],[1]],[[1],[1],[2],[2]],[[2],[1],[4],[2]],[[2],[1],[2,2],[2,2]],[[4],[2],[4],[4]],[[4],[2],[4,1],[2,4]],[[2,2],[2],[4,2],[4,2]],[[3,2],[2],[4,4],[4,4]],[[4,1],[2,2],[6,2],[6,2]],[[1,4],[4],[3,8],[4,4]],[[6,2],[2,2],[7,4],[4,6]],[[8,1],[4],[12,4],[8,4]],[[4,5],[3,1],[11,5],[11,5]],[[5,5],[5,1],[11,7],[5,7]],[[7,3],[5,1],[3,13],[15,2]],[[10,1],[1,5],[2,17],[1,15]],[[9,4],[5,1],[2,19],[17,1]],[[3,11],[3,4],[9,16],[17,4]],[[3,13],[3,5],[15,10],[15,5]],[[17],[4,4],[19,6],[17,6]],[[17],[2,7],[34],[7,16]],[[4,14],[4,5],[16,14],[11,14]],[[6,14],[6,4],[30,2],[11,16]],[[8,13],[8,4],[22,13],[7,22]],[[19,4],[10,2],[33,4],[28,6]],[[22,3],[8,4],[12,28],[8,26]],[[3,23],[3,10],[11,31],[4,31]],[[21,7],[7,7],[19,26],[1,37]],[[19,10],[5,10],[23,25],[15,25]],[[2,29],[13,3],[23,28],[42,1]],[[10,23],[17],[19,35],[10,35]],[[14,21],[17,1],[11,46],[29,19]],[[14,23],[13,6],[59,1],[44,7]],[[12,26],[12,7],[22,41],[39,14]],[[6,34],[6,14],[2,64],[46,10]],[[29,14],[17,4],[24,46],[49,10]],[[13,32],[4,18],[42,32],[48,14]],[[40,7],[20,4],[10,67],[43,22]],[[18,31],[19,6],[20,61],[34,34]]]};ReedSolomon.prototype={encode:function(t){null==this.gen_poly&&(this.gen_poly=this.genPoly(this.n_ec_bytes));var e,i=new Array(this.n_ec_bytes+1);for(e=0;e<this.n_ec_bytes+1;e++)i[e]=0;for(e=0;e<t.length;e++){var r,o=t[e]^i[this.n_ec_bytes-1];for(r=this.n_ec_bytes-1;r>0;r--)i[r]=i[r-1]^this.gmult(this.gen_poly[r],o);i[0]=this.gmult(this.gen_poly[0],o)}var s=[];for(e=this.n_ec_bytes-1;e>=0;e--)s.push(i[e]);return s},decode:function(t){this.bytes_in=t,this.bytes_out=t.slice();var e=this.calculateSyndroms();return e>0?this.correctErrors():this.corrected=!0,this.bytes_out.slice(0,this.bytes_out.length-this.n_ec_bytes)},genPoly:function(t){var e,i,r;i=this.zeroPoly(),i[0]=1;var o;for(o=0;t>o;o++)e=this.zeroPoly(),e[0]=this.gexp[o],e[1]=1,r=this.multPolys(e,i),i=this.copyPoly(r);return this.logger&&this.logger.debug("RS genPoly: "+r.join(",")),r},calculateSyndroms:function(){this.syndroms=[];var t,e,i,r=0;for(i=0;i<this.n_ec_bytes;i++){for(t=0,e=0;e<this.bytes_in.length;e++)t=this.bytes_in[e]^this.gmult(this.gexp[i],t);this.syndroms.push(t),t>0&&r++}return this.logger&&this.logger.debug(r>0?"RS calculateSyndroms: <b>Errors found!</b> syndroms = "+this.syndroms.join(","):"RS calculateSyndroms: <b>No errors</b>"),r},correctErrors:function(){if(this.berlekampMassey(),this.findRoots(),this.corrected=!1,2*this.n_errors>this.n_ec_bytes)return this.uncorrected_reason="too many errors",void(this.logger&&this.logger.debug("RS correctErrors: <b>"+this.uncorrected_reason+"</b>"));var t;for(t=0;t<this.n_errors;t++)if(this.error_locs[t]>=this.bytes_in.length)return this.uncorrected_reason="corrections out of scope",void(this.logger&&this.logger.debug("RS correctErrors: <b>"+this.uncorrected_reason+"</b>"));if(0===this.n_errors)return this.uncorrected_reason="could not identify errors",void(this.logger&&this.logger.debug("RS correctErrors: <b>"+this.uncorrected_reason+"</b>"));var e;for(e=0;e<this.n_errors;e++){var i,r=this.error_locs[e],o=0;for(i=0;i<this.n_degree_max;i++)o^=this.gmult(this.omega[i],this.gexp[(255-r)*i%255]);var s=0;for(i=0;i<this.n_degree_max;i+=2)s^=this.gmult(this.psi[i],this.gexp[(255-r)*i%255]);var n=this.gmult(o,this.ginv(s));this.logger&&this.logger.debug("RS correctErrors: loc="+(this.bytes_out.length-r-1)+"  err = 0x0"+n.toString(16)+" = bin "+n.toString(2)),this.bytes_out[this.bytes_out.length-r-1]^=n}this.corrected=!0},berlekampMassey:function(){var t=this.zeroPoly();t[0]=1;var e=this.copyPoly(t);this.mulZPoly(e),this.psi=this.copyPoly(t);var i,r,o=new Array(this.n_degree_max),s=-1,n=0;for(r=0;r<this.n_ec_bytes;r++){var a=this.computeDiscrepancy(this.psi,this.syndroms,n,r);if(0!==a){for(i=0;i<this.n_degree_max;i++)o[i]=this.psi[i]^this.gmult(a,e[i]);if(r-s>n){var h=r-s;for(s=r-n,i=0;i<this.n_degree_max;i++)e[i]=this.gmult(this.psi[i],this.ginv(a));n=h}this.psi=this.copyPoly(o)}this.mulZPoly(e)}this.logger&&this.logger.debug("RS berlekampMassey: psi = "+this.psi.join(","));var d=this.multPolys(this.psi,this.syndroms);for(this.omega=this.zeroPoly(),i=0;i<this.n_ec_bytes;i++)this.omega[i]=d[i];this.logger&&this.logger.debug("RS berlekampMassey: omega = "+this.omega.join(","))},findRoots:function(){this.n_errors=0,this.error_locs=[];var t,e;for(e=1;256>e;e++){t=0;var i;for(i=0;i<this.n_ec_bytes+1;i++)t^=this.gmult(this.gexp[i*e%255],this.psi[i]);0===t&&(this.error_locs.push(255-e),this.n_errors++)}this.logger&&this.logger.debug("RS findRoots: errors=<b>"+this.n_errors+"</b> locations = "+this.error_locs.join(","))},computeDiscrepancy:function(t,e,i,r){var o,s=0;for(o=0;i>=o;o++)s^=this.gmult(t[o],e[r-o]);return s},copyPoly:function(t){var e,i=new Array(this.n_degree_max);for(e=0;e<this.n_degree_max;e++)i[e]=t[e];return i},zeroPoly:function(){var t,e=new Array(this.n_degree_max);for(t=0;t<this.n_degree_max;t++)e[t]=0;return e},mulZPoly:function(t){var e;for(e=this.n_degree_max-1;e>0;e--)t[e]=t[e-1];t[0]=0},multPolys:function(t,e){var i,r=new Array(this.n_degree_max),o=new Array(2*this.n_degree_max);for(i=0;i<2*this.n_degree_max;i++)r[i]=0;for(i=0;i<this.n_degree_max;i++){var s;for(s=this.n_degree_max;s<2*this.n_degree_max;s++)o[s]=0;for(s=0;s<this.n_degree_max;s++)o[s]=this.gmult(e[s],t[i]);for(s=2*this.n_degree_max-1;s>=i;s--)o[s]=o[s-i];for(s=0;i>s;s++)o[s]=0;for(s=0;s<2*this.n_degree_max;s++)r[s]^=o[s]}return r},initGaloisTables:function(){var t=0,e=1,i=0,r=0,o=0,s=0,n=0,a=0,h=0;this.gexp=new Array(512),this.glog=new Array(256),this.gexp[0]=1,this.gexp[255]=this.gexp[0],this.glog[0]=0;var d;for(d=1;256>d;d++)t=h,h=a,a=n,n=s,s=o^t,o=r^t,r=i^t,i=e,e=t,this.gexp[d]=e+2*i+4*r+8*o+16*s+32*n+64*a+128*h,this.gexp[d+255]=this.gexp[d];for(d=1;256>d;d++){var u;for(u=0;256>u;u++)if(this.gexp[u]===d){this.glog[d]=u;break}}},gmult:function(t,e){if(0===t||0===e)return 0;var i=this.glog[t],r=this.glog[e];return this.gexp[i+r]},ginv:function(t){return this.gexp[255-this.glog[t]]}},QRDecode.prototype={decodePix:function(t){return this.decodeImage(t)},decodeImageData:function(t,e,i){return this.setImageData(t,e,i),this.decode()},decodeImageDataInsideBordersWithMaxVersion:function(t,e,i,r,o,s,n,a){return this.setImageData(t,e,i),this.imageLeft=r,this.imageRight=o,this.imageTop=s,this.imageBottom=n,this.imageSize=(this.imageRight-this.imageLeft+1+(this.imageBottom-this.imageTop+1))/2,this.maxVersion=a,this.decodeInsideBordersWithMaxVersion()},setImageData:function(t,e,i){t.minCol=255,t.maxCol=0;var r,o,s,n,a=0;for(r=0;e>r;r++)for(o=0;i>o;o++)s=4*r+o*e*4,n=.3*t.data[s]+.59*t.data[s+1]+.11*t.data[s+2],a+=n,n<t.minCol&&(t.minCol=n),n>t.maxCol&&(t.maxCol=n);if(t.maxCol-t.minCol<25.5)throw"Image does not have enough contrast (this.image_data.min_col="+t.minCol+" this.image_data.max_col="+t.maxCol+")";t.threshold=a/(e*i),t.getGray=function(t,e,i){var r,o,s,n=0;for(r=t;t+i>r;r++)for(o=e;e+i>o;o++)s=4*r+o*this.width*4,n=n+.3*this.data[s]+.59*this.data[s+1]+.11*this.data[s+2];return n/i/i},t.isDark=function(t,e,i){var r=this.getGray(t,e,i);return r<this.threshold},this.image=t},decodeImage:function(t){return this.image=t,this.decode()},decode:function(){return this.findImageBorders(),this.maxVersion=40,this.decodeInsideBordersWithMaxVersion(),this.data},decodeInsideBordersWithMaxVersion:function(){return this.findModuleSize(),QRBase.setFunctionalPattern(this),this.extractCodewords(),QRBase.setBlocks(this),this.correctErrors(),this.extractData(),this.data},findImageBorders:function(){var t,e,i,r=7,o=2;for(t=0;t<this.image.width;t++){for(i=0,e=0;e<this.image.height;e++)i+=this.image.isDark(t,e,1);if(i>=r)break}for(this.imageLeft=t,t=this.image.width-1;t>=0;t--){for(i=0,e=0;e<this.image.height;e++)i+=this.image.isDark(t,e,1);if(i>=r)break}for(this.imageRight=t,e=0;e<this.image.height;e++){for(i=0,t=0;t<this.image.width;t++)i+=this.image.isDark(t,e,1);if(i>=r)break}for(this.imageTop=e,e=this.image.height-1;e>=0;e--){for(i=0,t=0;t<this.image.width;t++)i+=this.image.isDark(t,e,1);if(i>=r)break}if(this.imageBottom=e,this.imageRight-this.imageLeft+1<21||this.imageBottom-this.imageTop+1<21)throw"Found no image data to decode";if(Math.abs(this.imageRight-this.imageLeft-(this.imageBottom-this.imageTop))>o)throw"Image data is not rectangular";this.imageSize=(this.imageRight-this.imageLeft+1+(this.imageBottom-this.imageTop+1))/2},findModuleSize:function(){function t(t,e,i,r,o,s){var n,a,h=0;for(n=0;5>=n;n++)t.isDarkWithSize(e+n,i,s)&&(h+=1),t.isDarkWithSize(e+6,i+n,s)&&(h+=1),t.isDarkWithSize(e+6-n,i+6,s)&&(h+=1),t.isDarkWithSize(e,i+6-n,s)&&(h+=1);for(n=0;3>=n;n++)t.isDarkWithSize(e+n+1,i+1,s)||(h+=1),t.isDarkWithSize(e+5,i+n+1,s)||(h+=1),t.isDarkWithSize(e+5-n,i+5,s)||(h+=1),t.isDarkWithSize(e+1,i+5-n,s)||(h+=1);for(n=0;2>=n;n++)for(a=0;2>=a;a++)t.isDarkWithSize(3+e,3+i,s)&&(h+=1);for(n=0;6>=n;n++)t.isDarkWithSize(e+r,i+n,s)||(h+=1),t.isDarkWithSize(e+n,i+o,s)||(h+=1);return t.isDarkWithSize(e+r,i+o,s)||(h+=1),h}function e(t,e,i,r){var o,s,n,a,h,d=0,u=6,l=8,c=0,f=1,g=5,m=[],v=!0;for(e&&(u=8,l=6,c=1,f=0),o=0;g>o;o++)m.push(1);for(s=0;i-8-8>s;s++){for(n=u+s*c,a=l+s*f,v===t.isDarkWithSize(n,a,r)?(d++,m.push(1)):m.push(0),v=!v,h=0,o=m.length-g;o<m.length-1;o++)m[o]&&(h+=1);if(3>h)return 0}return d}function i(t,e,i,r){var o,s=0;for(o=0;3>=o;o++)t.isDarkWithSize(e+o,i,r)&&(s+=1),t.isDarkWithSize(e+4,i+o,r)&&(s+=1),t.isDarkWithSize(e+4-o,i+4,r)&&(s+=1),t.isDarkWithSize(e,i+4-o,r)&&(s+=1);for(o=0;1>=o;o++)t.isDarkWithSize(e+o+1,i+1,r)||(s+=1),t.isDarkWithSize(e+3,i+o+1,r)||(s+=1),t.isDarkWithSize(e+3-o,i+3,r)||(s+=1),t.isDarkWithSize(e+1,i+3-o,r)||(s+=1);return t.isDarkWithSize(e+2,i+2,r)&&(s+=1),s}function r(t,e,r){var o,s,n,a=0,h=QRBase.alignmentPatterns[e].length;for(o=0;h>o;o++)for(s=0;h>s;s++)0===o&&0===s||0===o&&s===h-1||o===h-1&&0===s||(n=i(t,QRBase.alignmentPatterns[e][o]-2,QRBase.alignmentPatterns[e][s]-2,r),n>24&&a++);return a}function o(t,e){var i,r;for(i=7;40>=i;i++)if(r=t.hammingDistance(e,QRBase.versionInfo[i]),3>=r)return[i,r];return[0,4]}function s(t,e,i){var r,s,n=1,a=0;for(s=0;6>s;s++)for(r=e-11;e-11+3>r;r++)t.isDarkWithSize(r,s,i)&&(a+=n),n*=2;return o(t,a)}function n(t,e,i){var r,s,n=1,a=0;for(r=0;6>r;r++)for(s=e-11;e-11+3>s;s++)t.isDarkWithSize(r,s,i)&&(a+=n),n*=2;return o(t,a)}function a(t,e){var i,r;for(i=0;32>i;i++)if(r=t.hammingDistance(e,QRBase.formatInfo[i]),3>=r)return[i,r];return[0,4]}function h(t,e,i){var r,o=1,s=0,n=8;for(r=0;5>=r;r++)t.isDarkWithSize(n,r,i)&&(s+=o),o*=2;for(t.isDarkWithSize(8,7,i)&&(s+=o),o*=2,t.isDarkWithSize(8,8,i)&&(s+=o),o*=2,t.isDarkWithSize(7,8,i)&&(s+=o),o*=2,r=8,n=5;n>=0;n--)t.isDarkWithSize(n,r,i)&&(s+=o),o*=2;return a(t,s)}function d(t,e,i){var r,o=1,s=0,n=8;for(r=e-1;r>e-1-8;r--)t.isDarkWithSize(r,n,i)&&(s+=o),o*=2;for(r=8,n=e-7;e-1>n;n++)t.isDarkWithSize(r,n,i)&&(s+=o),o*=2;return a(t,s)}function u(t){var e,i=4;for(e=0;3>e;e++)i-=64-t[e];return 0>i&&(i=0),i}function l(t,e){var i=(t[0]+t[1])/(2*e);return i=1-i,i>=.14?0:i>=.11?1:i>=.07?2:i>=1e-5?3:4}function c(t,e){var i=t/e;return i=1-i,i>=.3?0:i>=.2?1:i>=.1?2:i>=1e-5?3:4}function f(i,o){var a,f,g,m,v,x,p,b=[],k=QRBase.nModulesFromVersion(o),_=i.imageSize/k,M=[0,0,0],D=[0,0],B=[0,0],I=[0,0],R=-3,y=0,C=4;if(M[0]=t(i,0,0,7,7,_),M[0]<61)return[o,0];if(M[1]=t(i,0,k-7,7,-1,_),M[0]+M[1]<125)return[o,0];if(M[2]=t(i,k-7,0,-1,7,_),a=u(M),1>a)return[o,0];if(b.push(a),o>=7){if(D=s(i,k,_),B=n(i,k,_),f=o,D[1]<B[1]?D[1]<4&&(f=D[0]):B[1]<4&&(f=B[0]),f!==o&&(o=f),k=QRBase.nModulesFromVersion(o),_=i.imageSize/k,a=Math.round((4-D[1]+(4-B[1]))/2),1>a)return[o,0];b.push(a)}if(I[0]=e(i,!0,k,_),I[1]=e(i,!1,k,_),a=l(I,k-8-8),1>a)return[o,0];if(b.push(a),o>1&&(R=r(i,o,_)),a=c(R,QRBase.alignmentPatterns[o].length*QRBase.alignmentPatterns[o].length-3),1>a)return[o,0];if(b.push(a),g=h(i,k,_),m=d(i,k,_),y=g[1]<m[1]?g[0]:m[0],v=Math.floor(y/8),x=y%8,a=Math.round((4-g[1]+(4-m[1]))/2),1>a)return[o,0];for(b.push(a),p=0;p<b.length;p++)b[p]<C&&(C=b[p]);return[o,C,v,x]}var g,m,v=[0,0];for(g=1;g<=this.maxVersion&&(m=f(this,g),m[1]>v[1]&&(v=m),4!==m[1]);g++);if(this.version=v[0],this.nModules=QRBase.nModulesFromVersion(this.version),this.moduleSize=this.imageSize/this.nModules,this.functionalGrade=v[1],this.ECLevel=v[2],this.mask=v[3],this.functionalGrade<1)throw"Unable to decode a function pattern"},extractCodewords:function(){function t(t,e,i){var r,o;switch(t.mask){case 0:r=(i+e)%2;break;case 1:r=i%2;break;case 2:r=e%3;break;case 3:r=(i+e)%3;break;case 4:r=(Math.floor(i/2)+Math.floor(e/3))%2;break;case 5:r=i*e%2+i*e%3;break;case 6:r=(i*e%2+i*e%3)%2;break;case 7:r=((i+e)%2+i*e%3)%2}return o=0===r?!t.isDark(e,i):t.isDark(e,i)}this.codewords=[];var e,i,r,o,s=!0,n=0,a=128,h=0;for(i=this.nModules-1;i>0;i-=2){for(6===i&&i--,o=0;o<this.nModules;o++)for(e=s?this.nModules-1-o:o,r=0;2>r;r++)this.functionalPattern[i-r][e]||(t(this,i-r,e)&&(n+=a),a/=2,1>a&&(this.codewords.push(n),h=0,a=128,n=0));s^=!0}},extractData:function(){function t(t,e,i,r){var o=24-(7&i)-r,s=(1<<r)-1,n=i>>>3;return(e[n]<<16|e[++n]<<8|e[++n])>>o&s}function e(e,i){var r,o,s=QRBase.nCountBits(QRBase.MODE.EightBit,e.version),n=t(e,i,e.bitIdx,s),a="";for(e.bitIdx+=s,r=0;n>r;r++)o=t(e,i,e.bitIdx,8),a+=String.fromCharCode(o),e.bitIdx+=8;return QRBase.utf8Tounicode(a)}function i(e,i){var r,o,s=QRBase.nCountBits(QRBase.MODE.AlphaNumeric,e.version),n=t(e,i,e.bitIdx,s),a="";for(e.bitIdx+=s,r=0;r<Math.floor(n/2);r++)o=t(e,i,e.bitIdx,11),a+=e.alphanum[Math.floor(o/45)],a+=e.alphanum[o%45],e.bitIdx+=11;return n%2&&(a+=e.alphanum[t(e,i,e.bitIdx,6)],e.bitIdx+=6),a}function r(e,i){var r,o,s,n,a,h=QRBase.nCountBits(QRBase.MODE.Numeric,e.version),d=t(e,i,e.bitIdx,h),u="";for(e.bitIdx+=h,a=0;a<Math.floor(d/3);a++)r=t(e,i,e.bitIdx,10),e.bitIdx+=10,o=Math.floor(r/100),s=Math.floor(r%100/10),n=r%10,u+=String.fromCharCode(48+o,48+s,48+n);return d%3===1?(r=t(e,i,e.bitIdx,4),e.bitIdx+=4,u+=String.fromCharCode(48+r)):d%3===2&&(r=t(e,i,e.bitIdx,7),e.bitIdx+=7,o=Math.floor(r/10),s=r%10,u+=String.fromCharCode(48+o,48+s)),u}var o,s,n=this.bytes,a=8*n.length;for(o=0;4>o;o++)n.push(0);for(this.data="",this.bitIdx=0;this.bitIdx<a-4&&(s=t(this,n,this.bitIdx,4),this.bitIdx+=4,s!==QRBase.MODE.Terminator);)if(s===QRBase.MODE.AlphaNumeric)this.data+=i(this,n);else if(s===QRBase.MODE.EightBit)this.data+=e(this,n);else{if(s!==QRBase.MODE.Numeric)throw"Unsupported ECI mode: "+s;this.data+=r(this,n)}},correctErrors:function(){var t,e,i,r,o=new ReedSolomon(this.nBlockEcWords),s=[],n=[];for(t=0;t<this.blockIndices.length;t++){for(e=[],r=0;r<this.blockIndices[t].length;r++)e.push(this.codewords[this.blockIndices[t][r]]);if(i=o.decode(e),!o.corrected)throw this.errorGrade=0,"Unable to correct errors ("+o.uncorrected_reason+")";n=n.concat(i),s.push(o.n_errors)}this.errors=s,this.bytes=n,this.errorGrade=this.gradeErrors(s)},gradeErrors:function(t){var e,i=this.nBlockEcWords,r=0,o=4;for(e=0;e<t.length;e++)t[e]>r&&(r=t[e]);return r>i/2-1?o=0:r>i/2-2?o=1:r>i/2-3?o=2:r>i/2-4&&(o=3),o},hammingDistance:function(t,e){function i(t){var e;for(e=0;t;e++)t&=t-1;return e}var r=t^e;return i(r)},isDarkWithSize:function(t,e,i){return this.image.isDark(Math.round(this.imageLeft+t*i),Math.round(this.imageTop+e*i),Math.round(i))},isDark:function(t,e){return this.isDarkWithSize(t,e,this.moduleSize)},alphanum:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"]},function(t,e,i,r){var o=function(e){var i,r=this;r.text="",t.extend(r,{_init:function(t){var e=new QRDecode,i=e.decodeImageData(t,r.width,r.height);return i},getImageData:function(e){var i;if("canvas"!==e.nodeName.toLowerCase()){if(!t(e).find("canvas").length)return!1;e=t(e).find("canvas")[0]}return i=e.getContext("2d"),r.width=e.width,r.height=e.height,i.getImageData(0,0,e.width,e.height)}}),i=r.getImageData(e),i&&(r.text=r._init(i))};t.fn.qrdecode=function(){var e=t(this),i=e.length,r="";return i&&(r=new o(e[0]).text),r}}(jQuery,window,document),QREncode.prototype={encodeToPix:function(t,e,i,r){var o,s=QRBase.nModulesFromVersion(i),n={};for(this.nModules=s,n.width=s,n.height=s,n.arr=[],o=0;s>o;o++)n.arr[o]=[];return n.setBackground=function(){for(o=0;s>o;o++){var t;for(t=0;s>t;t++)this.arr[o][t]=!1}},n.setDark=function(t,e){t>s-1||e>s-1||(this.arr[t][e]=!0)},n.isDark=function(t,e){return t>s-1||e>s-1?!1:n.arr[t][e]},this.encodeInit(i,r,n),this.encodeAddText(t,e),this.encode(),n.arr},setErrorThrow:function(t){QRBase.setErrorThrow(t)},encodeInit:function(t,e,i){this.version=t,this.ECLevel=e,this.image=i,this.image.setBackground(),this.bitIdx=0,QRBase.setBlocks(this),this.data=[];var r;for(r=0;r<this.nDataCodewords;r++)this.data[r]=0;for(this.pixels=[],r=0;r<this.nModules;r++)this.pixels[r]=[]},encodeAddText:function(t,e){this.addTextImplementation(t,e)},encode:function(){this.addTextImplementation(QRBase.MODE.Terminator,null),this.appendPadding(),this.addErrorCorrection(),this.encodeBestMask(),this.pixelsToImage()},addTextImplementation:function(t,e){function i(t,e,i,r){var o=e>>>3,s=24-(7&e)-i,n=r<<s;t[o+2]=255&n,n>>>=8,t[o+1]=255&n,n>>>=8,t[o]+=255&n}function r(t,e){return e=e.toUpperCase(),t.alphanumRev.hasOwnProperty(e)||QRBase.errorThrow("Invalid character for Alphanumeric encoding ["+e+"]"),t.alphanumRev[e]}function o(t,e){var o,s,n=e.length,a=QRBase.nCountBits(QRBase.MODE.AlphaNumeric,t.version);for(i(t.data,t.bitIdx,a,n),t.bitIdx+=a,o=0;n-1>o;o+=2)s=45*r(t,e[o])+r(t,e[o+1]),i(t.data,t.bitIdx,11,s),t.bitIdx+=11;n%2&&(i(t.data,t.bitIdx,6,r(t,e[n-1])),t.bitIdx+=6)}function s(t,e){var r,o=QRBase.nCountBits(QRBase.MODE.EightBit,t.version);for(i(t.data,t.bitIdx,o,e.length),t.bitIdx+=o,r=0;r<e.length;r++)i(t.data,t.bitIdx,8,e.charCodeAt(r)),t.bitIdx+=8}function n(t,e){var r,o,s,n=e.length,a=QRBase.nCountBits(QRBase.MODE.Numeric,t.version),h=[];for(i(t.data,t.bitIdx,a,n),t.bitIdx+=a,o=0;n>o;o++)s=e.charCodeAt(o)-48,(0>s||s>9)&&QRBase.errorThrow("Invalid character for Numeric encoding ["+e[o]+"]"),h.push(s);for(o=0;n-2>o;o+=3)r=100*h[o]+10*h[o+1]+h[o+2],i(t.data,t.bitIdx,10,r),t.bitIdx+=10;n%3===1?(r=h[n-1],i(t.data,t.bitIdx,4,r),t.bitIdx+=4):n%3===2&&(r=10*h[n-2]+h[n-1],i(t.data,t.bitIdx,7,r),t.bitIdx+=7)}if(i(this.data,this.bitIdx,4,t),this.bitIdx+=4,t===QRBase.MODE.AlphaNumeric)o(this,e);else if(t===QRBase.MODE.EightBit)s(this,QRBase.unicodeToUtf8(e));else if(t===QRBase.MODE.Numeric)n(this,e);else{if(t===QRBase.MODE.Terminator)return;QRBase.errorThrow("Unsupported ECI mode: "+t)}this.bitIdx/8>this.nDataCodewords&&QRBase.errorThrow("Text too long for this EC version")},appendPadding:function(){var t;for(t=Math.floor((this.bitIdx-1)/8)+1;t<this.nDataCodewords;t+=2)this.data[t]=236,this.data[t+1]=17},addErrorCorrection:function(){var t,e,i,r,o,s=new ReedSolomon(this.nBlockEcWords),n=[],a=0;for(t=0;t<this.blockDataLengths.length;t++){for(i=this.blockDataLengths[t],r=this.data.slice(a,a+i),a+=i,e=0;i>e;e++)n[this.blockIndices[t][e]]=r[e];for(o=s.encode(r),e=0;e<o.length;e++)n[this.blockIndices[t][i+e]]=o[e]}this.bytes=n},calculatePenalty:function(){function t(t){var e,i,r,o,s,n=0;for(e=0;e<t.nModules;e++)for(r=[0,0],o=[0,0],s=0;1>=s;s++){for(i=0;i<t.nModules;i++)t.pixels[s*e+(1-s)*i][(1-s)*e+s*i]?(o[s]>5&&(n+=3+o[s]-5),o[s]=0,r[s]++):(r[s]>5&&(n+=3+r[s]-5),o[s]++,r[s]=0);o[s]>5&&(n+=3+o[s]-5),r[s]>5&&(n+=3+r[s]-5)}return n}function e(t){var e,i,r,o=0;for(e=0;e<t.nModules-1;e++)for(i=0;i<t.nModules-1;i++)r=0,t.pixels[e][i]&&r++,t.pixels[e+1][i]&&r++,t.pixels[e][i+1]&&r++,t.pixels[e+1][i+1]&&r++,(0===r||4===r)&&(o+=3);return o}function i(t){var e,i,r,o,s=0,n=1488,a=2047,h=a<<4,d=32767;for(e=0;e<t.nModules-1;e++)for(r=[0,0],i=0;i<t.nModules-1;i++)for(o=0;1>=o;o++)r[o]=r[o]<<1&d,t.pixels[o*e+(1-o)*i][(1-o)*e+o*i]&&r[o]++,i>=11&&((r[o]&a)===n?s+=40:i<t.nModules-4-7&&(r[o]&h)===n&&(s+=40));return s}function r(t){var e,i,r=0;for(e=0;e<t.nModules-1;e++)for(i=0;i<t.nModules-1;i++)t.pixels[e][i]&&r++;return 10*Math.floor(Math.abs(r/(t.nModule*t.nModules)-.5)/.05)}var o=t(this),s=e(this),n=i(this),a=r(this),h=o+s+n+a;return h},encodeBestMask:function(){var t,e,i,r,o=0,s=999999;for(QRBase.setFunctionalPattern(this),t=0;8>t;t++){for(e=0;e<this.nModules;e++)for(i=0;i<this.nModules;i++)this.pixels[e][i]=!1;this.encodeFunctionalPatterns(t),this.encodeData(t),r=this.calculatePenalty(t),s>r&&(s=r,o=t)}if(this.mask=o,7!==this.mask){for(e=0;e<this.nModules;e++)for(i=0;i<this.nModules;i++)this.pixels[e][i]=!1;this.encodeFunctionalPatterns(this.mask),this.encodeData(this.mask)}},encodeFunctionalPatterns:function(t){function e(t,e,i){var r,o;for(r=0;5>=r;r++)t.pixels[e+r][i]=!0,t.pixels[e+6][i+r]=!0,t.pixels[e+6-r][i+6]=!0,t.pixels[e][i+6-r]=!0;for(r=2;4>=r;r++)for(o=2;4>=o;o++)t.pixels[e+r][i+o]=!0}function i(t){var e,i,r=QRBase.versionInfo[t.version];for(i=0;6>i;i++)for(e=t.nModules-11;e<t.nModules-11+3;e++)1&r&&(t.pixels[e][i]=!0),r/=2}function r(t){var e,i,r=QRBase.versionInfo[t.version];for(e=0;6>e;e++)for(i=t.nModules-11;i<t.nModules-11+3;i++)1&r&&(t.pixels[e][i]=!0),r/=2}function o(t,e){var i;for(i=8;i<t.nModules-8;i+=2)e?t.pixels[i][6]=!0:t.pixels[6][i]=!0}function s(t,e,i){var r;for(r=0;3>=r;r++)t.pixels[e+r][i]=!0,t.pixels[e+4][i+r]=!0,t.pixels[e+4-r][i+4]=!0,t.pixels[e][i+4-r]=!0;t.pixels[e+2][i+2]=!0}function n(t){var e,i,r=QRBase.alignmentPatterns[t.version].length;for(e=0;r>e;e++)for(i=0;r>i;i++)0===e&&0===i||0===e&&i===r-1||e===r-1&&0===i||s(t,QRBase.alignmentPatterns[t.version][e]-2,QRBase.alignmentPatterns[t.version][i]-2)}function a(t,e){var i,r=8;for(i=0;5>=i;i++)1&e&&(t.pixels[r][i]=!0),e/=2;for(1&e&&(t.pixels[8][7]=!0),e/=2,1&e&&(t.pixels[8][8]=!0),e/=2,1&e&&(t.pixels[7][8]=!0),e/=2,i=8,r=5;r>=0;r--)1&e&&(t.pixels[r][i]=!0),e/=2}function h(t,e){var i,r=8;for(i=t.nModules-1;i>t.nModules-1-8;i--)1&e&&(t.pixels[i][r]=!0),e/=2;for(i=8,r=t.nModules-7;r<t.nModules-1;r++)1&e&&(t.pixels[i][r]=!0),e/=2}e(this,0,0),e(this,0,this.nModules-7),e(this,this.nModules-7,0),this.version>=7&&(i(this),r(this)),o(this,!0),o(this,!1),this.version>1&&n(this);var d=QRBase.formatInfo[t+8*this.ECLevel];a(this,d),h(this,d)},encodeData:function(t){function e(t,e,i,r,o){var s;switch(e){case 0:s=(r+i)%2;break;case 1:s=r%2;break;case 2:s=i%3;break;case 3:s=(r+i)%3;break;case 4:s=(Math.floor(r/2)+Math.floor(i/3))%2;break;case 5:s=r*i%2+r*i%3;break;case 6:s=(r*i%2+r*i%3)%2;break;case 7:s=((r+i)%2+r*i%3)%2}0===s?t[i][r]=!o:t[i][r]=o}var i,r,o,s,n=!0,a=0,h=this.bytes[a],d=0,u=128;for(r=this.nModules-1;r>0;r-=2){for(6===r&&r--,o=0;o<this.nModules;o++)for(i=n?this.nModules-1-o:o,s=0;2>s;s++)this.functionalPattern[r-s][i]||(e(this.pixels,t,r-s,i,h&u),u>>>=1,d++,8===d&&(d=0,u=128,a++,h=this.bytes[a]));n^=!0}},pixelsToImage:function(){var t,e;for(t=0;t<this.nModules;t++)for(e=0;e<this.nModules;e++)this.pixels[t][e]&&this.setDark(t,e)},getDataCapacity:function(t,e,i){var r=QRBase.nCodewords[t],o=QRBase.nECCodewords[t][e],s=r-o,n=8*s,a=0;return n-=4,n-=QRBase.nCountBits(i,t),i===QRBase.MODE.AlphaNumeric?(a=2*Math.floor(n/11),n>=a/2*11+6&&a++):i===QRBase.MODE.EightBit?a=Math.floor(n/8):i===QRBase.MODE.Numeric?(a=3*Math.floor(n/10),n>=a/3*10+4&&(n>=a/3*10+7&&a++,a++)):QRBase.errorThrow("Unsupported ECI mode: "+i),a},getVersionFromLength:function(t,e,i){var r,o=QRBase.unicodeToUtf8(i).length;for(r=1;40>=r;r++)if(this.getDataCapacity(r,t,e)>=o)return r;QRBase.errorThrow("Text is too long, even for a version 40 QR Code")},setDark:function(t,e){this.image.setDark(t,e)},alphanumRev:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,I:18,J:19,K:20,L:21,M:22,N:23,O:24,P:25,Q:26,R:27,S:28,T:29,U:30,V:31,W:32,X:33,Y:34,Z:35," ":36,$:37,"%":38,"*":39,"+":40,"-":41,".":42,"/":43,":":44}},function(t,e,i,r){t.qrcode={config:{text:"Test",render:"canvas",bgColor:"#FFF",moduleColor:"#000",moduleSize:5,mode:4,ECLevel:2,margin:4,logo:"",error:function(t){alert(t)}},Render:[]};var o=function(e,i){var r=this;return r.config=e,t.extend(r,{_init:function(){r.qr=new QREncode,r.qr.setErrorThrow(function(t){e.error(t)}),e.logo&&(e.ECLevel=2),r.version=r.qr.getVersionFromLength(e.ECLevel,e.mode,e.text),r.pixArr=r.qr.encodeToPix(e.mode,e.text,r.version,e.ECLevel),t.qrcode.Render[e.render](r,i)}}),r._init()};t.fn.qrcode=function(e){var i,r=t(this),s=r.length,n={};"string"==typeof e?n.text=e:n=e,n=t.extend({},t.qrcode.config,n),new o(n,function(t){var e,o;for(i=0;s>i;i++)"table"===n.render?e=t.clone():(e=t.cloneNode(!0),o=e.getContext("2d"),o.drawImage(t,0,0)),r.eq(i).empty().append(e)})}}(jQuery,window,document),function(t,e,i,r){t.qrcode&&(t.qrcode.Render.canvas=function(e,r){var o=e.config,s=o.margin,n=o.margin,a=o.retina?2:1,h=o.moduleSize*a,d=e.pixArr.length,u=2*o.margin+d,l=i.createElement("canvas"),c=l.getContext("2d"),f=function(t){var e,i,r;if(0===t.indexOf("#")&&(t=t.substr(1)),6===t.length)e=t.substr(0,2),i=t.substr(2,2),r=t.substr(4,2);else{if(3!==t.length)throw"error color";e=t.substr(0,1),e+=e,i=t.substr(1,1),i+=i,r=t.substr(2,1),r+=r}return"rgb("+parseInt(e,16)+", "+parseInt(i,16)+", "+parseInt(r,16)+")"},g=function(){var i=2*o.margin+e.pixArr.length;l.width=i*h,l.height=i*h,t(l).css({width:i*o.moduleSize,height:i*o.moduleSize}),c.fillStyle=f(o.bgColor),c.fillRect(0,0,l.width,l.height)},m=function(t,e){c.fillStyle=f(o.moduleColor),c.fillRect(t*h,e*h,h,h)},v=function(e){var i=new Image;i.src=o.logo,i.onload=function(){var r,o=i.width,s=i.height,n=Math.max(o,s);n>d*h*.3&&(r=d*h*.3/n,o*=r,s*=r),c.drawImage(i,(u*h-o)/2,(u*h-s)/2,o,s),t.isFunction(e)&&e()}};for(g();s<e.pixArr.length+o.margin;s++)for(n=o.margin;n<e.pixArr.length+o.margin;n++)e.pixArr[s-o.margin][n-o.margin]&&m(s,n,f(o.moduleColor));o.logo?v(function(){t.isFunction(r)&&r(l)}):t.isFunction(r)&&r(l)})}(jQuery,window,document);