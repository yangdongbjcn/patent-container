"use strict";function ReedSolomon(e){this.logger=null,this.n_ec_bytes=e,this.n_degree_max=2*e,this.syndroms=[],this.gen_poly=null,this.initGaloisTables()}function QREncode(){this.image=null,this.nModules=0,this.version=0,this.functionalGrade=0,this.ECLevel=0,this.mask=0,this.maskPattern=[],this.nDataCodewords=0,this.nBlockEcWords=0,this.blockIndices=[],this.blockDataLengths=[]}var QRBase={MODE:{Numeric:1,AlphaNumeric:2,EightBit:4,Terminator:0},ERROR_CORRECTION_LEVEL:{L:1,M:0,Q:3,H:2},errorThrow:function(e){if(!this._isError){if(!this._errorThrow)throw e;this._errorThrow(e),this._isError=!0}},setBlocks:function(e){var t,r,o,s,i,n,a,h=this.nCodewords[e.version],l=this.nECCodewords[e.version][e.ECLevel],c=this.ECBlocks[e.version][e.ECLevel],d=0;for(e.nDataCodewords=h-l,1===c.length?(r=c[0],o=0,t=r,s=e.nDataCodewords/t,i=0):(r=c[0],o=c[1],t=r+o,s=Math.floor(e.nDataCodewords/t),i=s+1),e.nBlockEcWords=l/t,e.blockDataLengths=[],a=0;r>a;a++)e.blockDataLengths[a]=s;for(a=r;t>a;a++)e.blockDataLengths[a]=i;for(e.blockIndices=[],a=0;t>a;a++)e.blockIndices[a]=[];for(n=0;s>n;n++)for(a=0;t>a;a++)e.blockIndices[a].push(d),d++;for(a=r;t>a;a++)e.blockIndices[a].push(d),d++;for(n=0;n<e.nBlockEcWords;n++)for(a=0;t>a;a++)e.blockIndices[a].push(d),d++},setFunctionalPattern:function(e){function t(e,t,r,o,s){var i,n;for(i=t;t+o>i;i++)for(n=r;r+s>n;n++)e.functionalPattern[i][n]=!0}function r(e,r){var o,s,i=r.alignmentPatterns[e.version].length;for(o=0;i>o;o++)for(s=0;i>s;s++)0===o&&0===s||0===o&&s===i-1||o===i-1&&0===s||t(e,r.alignmentPatterns[e.version][o]-2,r.alignmentPatterns[e.version][s]-2,5,5)}e.functionalPattern=[];var o,s;for(o=0;o<e.nModules;o++)for(e.functionalPattern[o]=[],s=0;s<e.nModules;s++)e.functionalPattern[o][s]=!1;t(e,0,0,9,9),t(e,e.nModules-8,0,8,9),t(e,0,e.nModules-8,9,8),t(e,8,6,e.nModules-8-8,1),t(e,6,8,1,e.nModules-8-8),r(e,this),e.version>=7&&(t(e,0,e.nModules-11,6,3),t(e,e.nModules-11,0,3,6))},nCountBits:function(e,t){return e===this.MODE.EightBit?10>t?8:16:e===this.MODE.AlphaNumeric?10>t?9:27>t?11:13:e===this.MODE.Numeric?10>t?10:27>t?12:14:void this.errorThrow("Internal error: Unknown mode: "+e)},nModulesFromVersion:function(e){return 17+4*e},unicodeToUtf8:function(e){var t,r,o="",s=e.length;for(t=0;s>t;t++)r=e.charCodeAt(t),r>=1&&127>=r?o+=e.charAt(t):r>2047?(o+=String.fromCharCode(224|r>>12&15),o+=String.fromCharCode(128|r>>6&63),o+=String.fromCharCode(128|r>>0&63)):(o+=String.fromCharCode(192|r>>6&31),o+=String.fromCharCode(128|r>>0&63));return o},utf8Tounicode:function(e){for(var t,r,o,s,i="",n=e.length,a=0;n>a;)r=e.charCodeAt(a++),t=r>>4,7>=t?i+=e.charAt(a-1):12===t||13===t?(o=e.charCodeAt(a++),i+=String.fromCharCode((31&r)<<6|63&o)):14===t&&(o=e.charCodeAt(a++),s=e.charCodeAt(a++),i+=String.fromCharCode((15&r)<<12|(63&o)<<6|(63&s)<<0));return i},setErrorThrow:function(e){"function"==typeof e&&(this._errorThrow=e)},alignmentPatterns:[null,[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],versionInfo:[null,null,null,null,null,null,null,31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017],formatInfo:[21522,20773,24188,23371,17913,16590,20375,19104,30660,29427,32170,30877,26159,25368,27713,26998,5769,5054,7399,6608,1890,597,3340,2107,13663,12392,16177,14854,9396,8579,11994,11245],nCodewords:[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706],nECCodewords:[null,[10,7,17,13],[16,10,28,22],[26,15,44,36],[36,20,64,52],[48,26,88,72],[64,36,112,96],[72,40,130,108],[88,48,156,132],[110,60,192,160],[130,72,224,192],[150,80,264,224],[176,96,308,260],[198,104,352,288],[216,120,384,320],[240,132,432,360],[280,144,480,408],[308,168,532,448],[338,180,588,504],[364,196,650,546],[416,224,700,600],[442,224,750,644],[476,252,816,690],[504,270,900,750],[560,300,960,810],[588,312,1050,870],[644,336,1110,952],[700,360,1200,1020],[728,390,1260,1050],[784,420,1350,1140],[812,450,1440,1200],[868,480,1530,1290],[924,510,1620,1350],[980,540,1710,1440],[1036,570,1800,1530],[1064,570,1890,1590],[1120,600,1980,1680],[1204,630,2100,1770],[1260,660,2220,1860],[1316,720,2310,1950],[1372,750,2430,2040]],ECBlocks:[[],[[1],[1],[1],[1]],[[1],[1],[1],[1]],[[1],[1],[2],[2]],[[2],[1],[4],[2]],[[2],[1],[2,2],[2,2]],[[4],[2],[4],[4]],[[4],[2],[4,1],[2,4]],[[2,2],[2],[4,2],[4,2]],[[3,2],[2],[4,4],[4,4]],[[4,1],[2,2],[6,2],[6,2]],[[1,4],[4],[3,8],[4,4]],[[6,2],[2,2],[7,4],[4,6]],[[8,1],[4],[12,4],[8,4]],[[4,5],[3,1],[11,5],[11,5]],[[5,5],[5,1],[11,7],[5,7]],[[7,3],[5,1],[3,13],[15,2]],[[10,1],[1,5],[2,17],[1,15]],[[9,4],[5,1],[2,19],[17,1]],[[3,11],[3,4],[9,16],[17,4]],[[3,13],[3,5],[15,10],[15,5]],[[17],[4,4],[19,6],[17,6]],[[17],[2,7],[34],[7,16]],[[4,14],[4,5],[16,14],[11,14]],[[6,14],[6,4],[30,2],[11,16]],[[8,13],[8,4],[22,13],[7,22]],[[19,4],[10,2],[33,4],[28,6]],[[22,3],[8,4],[12,28],[8,26]],[[3,23],[3,10],[11,31],[4,31]],[[21,7],[7,7],[19,26],[1,37]],[[19,10],[5,10],[23,25],[15,25]],[[2,29],[13,3],[23,28],[42,1]],[[10,23],[17],[19,35],[10,35]],[[14,21],[17,1],[11,46],[29,19]],[[14,23],[13,6],[59,1],[44,7]],[[12,26],[12,7],[22,41],[39,14]],[[6,34],[6,14],[2,64],[46,10]],[[29,14],[17,4],[24,46],[49,10]],[[13,32],[4,18],[42,32],[48,14]],[[40,7],[20,4],[10,67],[43,22]],[[18,31],[19,6],[20,61],[34,34]]]};ReedSolomon.prototype={encode:function(e){null==this.gen_poly&&(this.gen_poly=this.genPoly(this.n_ec_bytes));var t,r=new Array(this.n_ec_bytes+1);for(t=0;t<this.n_ec_bytes+1;t++)r[t]=0;for(t=0;t<e.length;t++){var o,s=e[t]^r[this.n_ec_bytes-1];for(o=this.n_ec_bytes-1;o>0;o--)r[o]=r[o-1]^this.gmult(this.gen_poly[o],s);r[0]=this.gmult(this.gen_poly[0],s)}var i=[];for(t=this.n_ec_bytes-1;t>=0;t--)i.push(r[t]);return i},decode:function(e){this.bytes_in=e,this.bytes_out=e.slice();var t=this.calculateSyndroms();return t>0?this.correctErrors():this.corrected=!0,this.bytes_out.slice(0,this.bytes_out.length-this.n_ec_bytes)},genPoly:function(e){var t,r,o;r=this.zeroPoly(),r[0]=1;var s;for(s=0;e>s;s++)t=this.zeroPoly(),t[0]=this.gexp[s],t[1]=1,o=this.multPolys(t,r),r=this.copyPoly(o);return this.logger&&this.logger.debug("RS genPoly: "+o.join(",")),o},calculateSyndroms:function(){this.syndroms=[];var e,t,r,o=0;for(r=0;r<this.n_ec_bytes;r++){for(e=0,t=0;t<this.bytes_in.length;t++)e=this.bytes_in[t]^this.gmult(this.gexp[r],e);this.syndroms.push(e),e>0&&o++}return this.logger&&this.logger.debug(o>0?"RS calculateSyndroms: <b>Errors found!</b> syndroms = "+this.syndroms.join(","):"RS calculateSyndroms: <b>No errors</b>"),o},correctErrors:function(){if(this.berlekampMassey(),this.findRoots(),this.corrected=!1,2*this.n_errors>this.n_ec_bytes)return this.uncorrected_reason="too many errors",void(this.logger&&this.logger.debug("RS correctErrors: <b>"+this.uncorrected_reason+"</b>"));var e;for(e=0;e<this.n_errors;e++)if(this.error_locs[e]>=this.bytes_in.length)return this.uncorrected_reason="corrections out of scope",void(this.logger&&this.logger.debug("RS correctErrors: <b>"+this.uncorrected_reason+"</b>"));if(0===this.n_errors)return this.uncorrected_reason="could not identify errors",void(this.logger&&this.logger.debug("RS correctErrors: <b>"+this.uncorrected_reason+"</b>"));var t;for(t=0;t<this.n_errors;t++){var r,o=this.error_locs[t],s=0;for(r=0;r<this.n_degree_max;r++)s^=this.gmult(this.omega[r],this.gexp[(255-o)*r%255]);var i=0;for(r=0;r<this.n_degree_max;r+=2)i^=this.gmult(this.psi[r],this.gexp[(255-o)*r%255]);var n=this.gmult(s,this.ginv(i));this.logger&&this.logger.debug("RS correctErrors: loc="+(this.bytes_out.length-o-1)+"  err = 0x0"+n.toString(16)+" = bin "+n.toString(2)),this.bytes_out[this.bytes_out.length-o-1]^=n}this.corrected=!0},berlekampMassey:function(){var e=this.zeroPoly();e[0]=1;var t=this.copyPoly(e);this.mulZPoly(t),this.psi=this.copyPoly(e);var r,o,s=new Array(this.n_degree_max),i=-1,n=0;for(o=0;o<this.n_ec_bytes;o++){var a=this.computeDiscrepancy(this.psi,this.syndroms,n,o);if(0!==a){for(r=0;r<this.n_degree_max;r++)s[r]=this.psi[r]^this.gmult(a,t[r]);if(o-i>n){var h=o-i;for(i=o-n,r=0;r<this.n_degree_max;r++)t[r]=this.gmult(this.psi[r],this.ginv(a));n=h}this.psi=this.copyPoly(s)}this.mulZPoly(t)}this.logger&&this.logger.debug("RS berlekampMassey: psi = "+this.psi.join(","));var l=this.multPolys(this.psi,this.syndroms);for(this.omega=this.zeroPoly(),r=0;r<this.n_ec_bytes;r++)this.omega[r]=l[r];this.logger&&this.logger.debug("RS berlekampMassey: omega = "+this.omega.join(","))},findRoots:function(){this.n_errors=0,this.error_locs=[];var e,t;for(t=1;256>t;t++){e=0;var r;for(r=0;r<this.n_ec_bytes+1;r++)e^=this.gmult(this.gexp[r*t%255],this.psi[r]);0===e&&(this.error_locs.push(255-t),this.n_errors++)}this.logger&&this.logger.debug("RS findRoots: errors=<b>"+this.n_errors+"</b> locations = "+this.error_locs.join(","))},computeDiscrepancy:function(e,t,r,o){var s,i=0;for(s=0;r>=s;s++)i^=this.gmult(e[s],t[o-s]);return i},copyPoly:function(e){var t,r=new Array(this.n_degree_max);for(t=0;t<this.n_degree_max;t++)r[t]=e[t];return r},zeroPoly:function(){var e,t=new Array(this.n_degree_max);for(e=0;e<this.n_degree_max;e++)t[e]=0;return t},mulZPoly:function(e){var t;for(t=this.n_degree_max-1;t>0;t--)e[t]=e[t-1];e[0]=0},multPolys:function(e,t){var r,o=new Array(this.n_degree_max),s=new Array(2*this.n_degree_max);for(r=0;r<2*this.n_degree_max;r++)o[r]=0;for(r=0;r<this.n_degree_max;r++){var i;for(i=this.n_degree_max;i<2*this.n_degree_max;i++)s[i]=0;for(i=0;i<this.n_degree_max;i++)s[i]=this.gmult(t[i],e[r]);for(i=2*this.n_degree_max-1;i>=r;i--)s[i]=s[i-r];for(i=0;r>i;i++)s[i]=0;for(i=0;i<2*this.n_degree_max;i++)o[i]^=s[i]}return o},initGaloisTables:function(){var e=0,t=1,r=0,o=0,s=0,i=0,n=0,a=0,h=0;this.gexp=new Array(512),this.glog=new Array(256),this.gexp[0]=1,this.gexp[255]=this.gexp[0],this.glog[0]=0;var l;for(l=1;256>l;l++)e=h,h=a,a=n,n=i,i=s^e,s=o^e,o=r^e,r=t,t=e,this.gexp[l]=t+2*r+4*o+8*s+16*i+32*n+64*a+128*h,this.gexp[l+255]=this.gexp[l];for(l=1;256>l;l++){var c;for(c=0;256>c;c++)if(this.gexp[c]===l){this.glog[l]=c;break}}},gmult:function(e,t){if(0===e||0===t)return 0;var r=this.glog[e],o=this.glog[t];return this.gexp[r+o]},ginv:function(e){return this.gexp[255-this.glog[e]]}},QREncode.prototype={encodeToPix:function(e,t,r,o){var s,i=QRBase.nModulesFromVersion(r),n={};for(this.nModules=i,n.width=i,n.height=i,n.arr=[],s=0;i>s;s++)n.arr[s]=[];return n.setBackground=function(){for(s=0;i>s;s++){var e;for(e=0;i>e;e++)this.arr[s][e]=!1}},n.setDark=function(e,t){e>i-1||t>i-1||(this.arr[e][t]=!0)},n.isDark=function(e,t){return e>i-1||t>i-1?!1:n.arr[e][t]},this.encodeInit(r,o,n),this.encodeAddText(e,t),this.encode(),n.arr},setErrorThrow:function(e){QRBase.setErrorThrow(e)},encodeInit:function(e,t,r){this.version=e,this.ECLevel=t,this.image=r,this.image.setBackground(),this.bitIdx=0,QRBase.setBlocks(this),this.data=[];var o;for(o=0;o<this.nDataCodewords;o++)this.data[o]=0;for(this.pixels=[],o=0;o<this.nModules;o++)this.pixels[o]=[]},encodeAddText:function(e,t){this.addTextImplementation(e,t)},encode:function(){this.addTextImplementation(QRBase.MODE.Terminator,null),this.appendPadding(),this.addErrorCorrection(),this.encodeBestMask(),this.pixelsToImage()},addTextImplementation:function(e,t){function r(e,t,r,o){var s=t>>>3,i=24-(7&t)-r,n=o<<i;e[s+2]=255&n,n>>>=8,e[s+1]=255&n,n>>>=8,e[s]+=255&n}function o(e,t){return t=t.toUpperCase(),e.alphanumRev.hasOwnProperty(t)||QRBase.errorThrow("Invalid character for Alphanumeric encoding ["+t+"]"),e.alphanumRev[t]}function s(e,t){var s,i,n=t.length,a=QRBase.nCountBits(QRBase.MODE.AlphaNumeric,e.version);for(r(e.data,e.bitIdx,a,n),e.bitIdx+=a,s=0;n-1>s;s+=2)i=45*o(e,t[s])+o(e,t[s+1]),r(e.data,e.bitIdx,11,i),e.bitIdx+=11;n%2&&(r(e.data,e.bitIdx,6,o(e,t[n-1])),e.bitIdx+=6)}function i(e,t){var o,s=QRBase.nCountBits(QRBase.MODE.EightBit,e.version);for(r(e.data,e.bitIdx,s,t.length),e.bitIdx+=s,o=0;o<t.length;o++)r(e.data,e.bitIdx,8,t.charCodeAt(o)),e.bitIdx+=8}function n(e,t){var o,s,i,n=t.length,a=QRBase.nCountBits(QRBase.MODE.Numeric,e.version),h=[];for(r(e.data,e.bitIdx,a,n),e.bitIdx+=a,s=0;n>s;s++)i=t.charCodeAt(s)-48,(0>i||i>9)&&QRBase.errorThrow("Invalid character for Numeric encoding ["+t[s]+"]"),h.push(i);for(s=0;n-2>s;s+=3)o=100*h[s]+10*h[s+1]+h[s+2],r(e.data,e.bitIdx,10,o),e.bitIdx+=10;n%3===1?(o=h[n-1],r(e.data,e.bitIdx,4,o),e.bitIdx+=4):n%3===2&&(o=10*h[n-2]+h[n-1],r(e.data,e.bitIdx,7,o),e.bitIdx+=7)}if(r(this.data,this.bitIdx,4,e),this.bitIdx+=4,e===QRBase.MODE.AlphaNumeric)s(this,t);else if(e===QRBase.MODE.EightBit)i(this,QRBase.unicodeToUtf8(t));else if(e===QRBase.MODE.Numeric)n(this,t);else{if(e===QRBase.MODE.Terminator)return;QRBase.errorThrow("Unsupported ECI mode: "+e)}this.bitIdx/8>this.nDataCodewords&&QRBase.errorThrow("Text too long for this EC version")},appendPadding:function(){var e;for(e=Math.floor((this.bitIdx-1)/8)+1;e<this.nDataCodewords;e+=2)this.data[e]=236,this.data[e+1]=17},addErrorCorrection:function(){var e,t,r,o,s,i=new ReedSolomon(this.nBlockEcWords),n=[],a=0;for(e=0;e<this.blockDataLengths.length;e++){for(r=this.blockDataLengths[e],o=this.data.slice(a,a+r),a+=r,t=0;r>t;t++)n[this.blockIndices[e][t]]=o[t];for(s=i.encode(o),t=0;t<s.length;t++)n[this.blockIndices[e][r+t]]=s[t]}this.bytes=n},calculatePenalty:function(){function e(e){var t,r,o,s,i,n=0;for(t=0;t<e.nModules;t++)for(o=[0,0],s=[0,0],i=0;1>=i;i++){for(r=0;r<e.nModules;r++)e.pixels[i*t+(1-i)*r][(1-i)*t+i*r]?(s[i]>5&&(n+=3+s[i]-5),s[i]=0,o[i]++):(o[i]>5&&(n+=3+o[i]-5),s[i]++,o[i]=0);s[i]>5&&(n+=3+s[i]-5),o[i]>5&&(n+=3+o[i]-5)}return n}function t(e){var t,r,o,s=0;for(t=0;t<e.nModules-1;t++)for(r=0;r<e.nModules-1;r++)o=0,e.pixels[t][r]&&o++,e.pixels[t+1][r]&&o++,e.pixels[t][r+1]&&o++,e.pixels[t+1][r+1]&&o++,(0===o||4===o)&&(s+=3);return s}function r(e){var t,r,o,s,i=0,n=1488,a=2047,h=a<<4,l=32767;for(t=0;t<e.nModules-1;t++)for(o=[0,0],r=0;r<e.nModules-1;r++)for(s=0;1>=s;s++)o[s]=o[s]<<1&l,e.pixels[s*t+(1-s)*r][(1-s)*t+s*r]&&o[s]++,r>=11&&((o[s]&a)===n?i+=40:r<e.nModules-4-7&&(o[s]&h)===n&&(i+=40));return i}function o(e){var t,r,o=0;for(t=0;t<e.nModules-1;t++)for(r=0;r<e.nModules-1;r++)e.pixels[t][r]&&o++;return 10*Math.floor(Math.abs(o/(e.nModule*e.nModules)-.5)/.05)}var s=e(this),i=t(this),n=r(this),a=o(this),h=s+i+n+a;return h},encodeBestMask:function(){var e,t,r,o,s=0,i=999999;for(QRBase.setFunctionalPattern(this),e=0;8>e;e++){for(t=0;t<this.nModules;t++)for(r=0;r<this.nModules;r++)this.pixels[t][r]=!1;this.encodeFunctionalPatterns(e),this.encodeData(e),o=this.calculatePenalty(e),i>o&&(i=o,s=e)}if(this.mask=s,7!==this.mask){for(t=0;t<this.nModules;t++)for(r=0;r<this.nModules;r++)this.pixels[t][r]=!1;this.encodeFunctionalPatterns(this.mask),this.encodeData(this.mask)}},encodeFunctionalPatterns:function(e){function t(e,t,r){var o,s;for(o=0;5>=o;o++)e.pixels[t+o][r]=!0,e.pixels[t+6][r+o]=!0,e.pixels[t+6-o][r+6]=!0,e.pixels[t][r+6-o]=!0;for(o=2;4>=o;o++)for(s=2;4>=s;s++)e.pixels[t+o][r+s]=!0}function r(e){var t,r,o=QRBase.versionInfo[e.version];for(r=0;6>r;r++)for(t=e.nModules-11;t<e.nModules-11+3;t++)1&o&&(e.pixels[t][r]=!0),o/=2}function o(e){var t,r,o=QRBase.versionInfo[e.version];for(t=0;6>t;t++)for(r=e.nModules-11;r<e.nModules-11+3;r++)1&o&&(e.pixels[t][r]=!0),o/=2}function s(e,t){var r;for(r=8;r<e.nModules-8;r+=2)t?e.pixels[r][6]=!0:e.pixels[6][r]=!0}function i(e,t,r){var o;for(o=0;3>=o;o++)e.pixels[t+o][r]=!0,e.pixels[t+4][r+o]=!0,e.pixels[t+4-o][r+4]=!0,e.pixels[t][r+4-o]=!0;e.pixels[t+2][r+2]=!0}function n(e){var t,r,o=QRBase.alignmentPatterns[e.version].length;for(t=0;o>t;t++)for(r=0;o>r;r++)0===t&&0===r||0===t&&r===o-1||t===o-1&&0===r||i(e,QRBase.alignmentPatterns[e.version][t]-2,QRBase.alignmentPatterns[e.version][r]-2)}function a(e,t){var r,o=8;for(r=0;5>=r;r++)1&t&&(e.pixels[o][r]=!0),t/=2;for(1&t&&(e.pixels[8][7]=!0),t/=2,1&t&&(e.pixels[8][8]=!0),t/=2,1&t&&(e.pixels[7][8]=!0),t/=2,r=8,o=5;o>=0;o--)1&t&&(e.pixels[o][r]=!0),t/=2}function h(e,t){var r,o=8;for(r=e.nModules-1;r>e.nModules-1-8;r--)1&t&&(e.pixels[r][o]=!0),t/=2;for(r=8,o=e.nModules-7;o<e.nModules-1;o++)1&t&&(e.pixels[r][o]=!0),t/=2}t(this,0,0),t(this,0,this.nModules-7),t(this,this.nModules-7,0),this.version>=7&&(r(this),o(this)),s(this,!0),s(this,!1),this.version>1&&n(this);var l=QRBase.formatInfo[e+8*this.ECLevel];a(this,l),h(this,l)},encodeData:function(e){function t(e,t,r,o,s){var i;switch(t){case 0:i=(o+r)%2;break;case 1:i=o%2;break;case 2:i=r%3;break;case 3:i=(o+r)%3;break;case 4:i=(Math.floor(o/2)+Math.floor(r/3))%2;break;case 5:i=o*r%2+o*r%3;break;case 6:i=(o*r%2+o*r%3)%2;break;case 7:i=((o+r)%2+o*r%3)%2}0===i?e[r][o]=!s:e[r][o]=s}var r,o,s,i,n=!0,a=0,h=this.bytes[a],l=0,c=128;for(o=this.nModules-1;o>0;o-=2){for(6===o&&o--,s=0;s<this.nModules;s++)for(r=n?this.nModules-1-s:s,i=0;2>i;i++)this.functionalPattern[o-i][r]||(t(this.pixels,e,o-i,r,h&c),c>>>=1,l++,8===l&&(l=0,c=128,a++,h=this.bytes[a]));n^=!0}},pixelsToImage:function(){var e,t;for(e=0;e<this.nModules;e++)for(t=0;t<this.nModules;t++)this.pixels[e][t]&&this.setDark(e,t)},getDataCapacity:function(e,t,r){var o=QRBase.nCodewords[e],s=QRBase.nECCodewords[e][t],i=o-s,n=8*i,a=0;return n-=4,n-=QRBase.nCountBits(r,e),r===QRBase.MODE.AlphaNumeric?(a=2*Math.floor(n/11),n>=a/2*11+6&&a++):r===QRBase.MODE.EightBit?a=Math.floor(n/8):r===QRBase.MODE.Numeric?(a=3*Math.floor(n/10),n>=a/3*10+4&&(n>=a/3*10+7&&a++,a++)):QRBase.errorThrow("Unsupported ECI mode: "+r),a},getVersionFromLength:function(e,t,r){var o,s=QRBase.unicodeToUtf8(r).length;for(o=1;40>=o;o++)if(this.getDataCapacity(o,e,t)>=s)return o;QRBase.errorThrow("Text is too long, even for a version 40 QR Code")},setDark:function(e,t){this.image.setDark(e,t)},alphanumRev:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,I:18,J:19,K:20,L:21,M:22,N:23,O:24,P:25,Q:26,R:27,S:28,T:29,U:30,V:31,W:32,X:33,Y:34,Z:35," ":36,$:37,"%":38,"*":39,"+":40,"-":41,".":42,"/":43,":":44}},function(e,t,r,o){e.qrcode={config:{text:"Test",render:"canvas",bgColor:"#FFF",moduleColor:"#000",moduleSize:5,mode:4,ECLevel:2,margin:4,logo:"",error:function(e){alert(e)}},Render:[]};var s=function(t,r){var o=this;return o.config=t,e.extend(o,{_init:function(){o.qr=new QREncode,o.qr.setErrorThrow(function(e){t.error(e)}),t.logo&&(t.ECLevel=2),o.version=o.qr.getVersionFromLength(t.ECLevel,t.mode,t.text),o.pixArr=o.qr.encodeToPix(t.mode,t.text,o.version,t.ECLevel),e.qrcode.Render[t.render](o,r)}}),o._init()};e.fn.qrcode=function(t){var r,o=e(this),i=o.length,n={};"string"==typeof t?n.text=t:n=t,n=e.extend({},e.qrcode.config,n),new s(n,function(e){var t,s;for(r=0;i>r;r++)"table"===n.render?t=e.clone():(t=e.cloneNode(!0),s=t.getContext("2d"),s.drawImage(e,0,0)),o.eq(r).empty().append(t)})}}(jQuery,window,document),function(e,t,r,o){e.qrcode&&(e.qrcode.Render.canvas=function(t,o){var s=t.config,i=s.margin,n=s.margin,a=s.retina?2:1,h=s.moduleSize*a,l=t.pixArr.length,c=2*s.margin+l,d=r.createElement("canvas"),u=d.getContext("2d"),f=function(e){var t,r,o;if(0===e.indexOf("#")&&(e=e.substr(1)),6===e.length)t=e.substr(0,2),r=e.substr(2,2),o=e.substr(4,2);else{if(3!==e.length)throw"error color";t=e.substr(0,1),t+=t,r=e.substr(1,1),r+=r,o=e.substr(2,1),o+=o}return"rgb("+parseInt(t,16)+", "+parseInt(r,16)+", "+parseInt(o,16)+")"},g=function(){var r=2*s.margin+t.pixArr.length;d.width=r*h,d.height=r*h,e(d).css({width:r*s.moduleSize,height:r*s.moduleSize}),u.fillStyle=f(s.bgColor),u.fillRect(0,0,d.width,d.height)},m=function(e,t){u.fillStyle=f(s.moduleColor),u.fillRect(e*h,t*h,h,h)},p=function(t){var r=new Image;r.src=s.logo,r.onload=function(){var o,s=r.width,i=r.height,n=Math.max(s,i);n>l*h*.3&&(o=l*h*.3/n,s*=o,i*=o),u.drawImage(r,(c*h-s)/2,(c*h-i)/2,s,i),e.isFunction(t)&&t()}};for(g();i<t.pixArr.length+s.margin;i++)for(n=s.margin;n<t.pixArr.length+s.margin;n++)t.pixArr[i-s.margin][n-s.margin]&&m(i,n,f(s.moduleColor));s.logo?p(function(){e.isFunction(o)&&o(d)}):e.isFunction(o)&&o(d)})}(jQuery,window,document);