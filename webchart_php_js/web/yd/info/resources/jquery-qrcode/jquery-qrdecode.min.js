"use strict";function ReedSolomon(t){this.logger=null,this.n_ec_bytes=t,this.n_degree_max=2*t,this.syndroms=[],this.gen_poly=null,this.initGaloisTables()}function QRDecode(){this.image=null,this.imageTop=0,this.imageBottom=0,this.imageLeft=0,this.imageRight=0,this.nModules=0,this.moduleSize=0,this.version=0,this.functionalGrade=0,this.ECLevel=0,this.mask=0,this.maskPattern=[],this.nBlockEcWords=0,this.blockIndices=[],this.blockDataLengths=[]}var QRBase={MODE:{Numeric:1,AlphaNumeric:2,EightBit:4,Terminator:0},ERROR_CORRECTION_LEVEL:{L:1,M:0,Q:3,H:2},errorThrow:function(t){if(!this._isError){if(!this._errorThrow)throw t;this._errorThrow(t),this._isError=!0}},setBlocks:function(t){var i,r,e,o,s,n,a,h=this.nCodewords[t.version],u=this.nECCodewords[t.version][t.ECLevel],c=this.ECBlocks[t.version][t.ECLevel],g=0;for(t.nDataCodewords=h-u,1===c.length?(r=c[0],e=0,i=r,o=t.nDataCodewords/i,s=0):(r=c[0],e=c[1],i=r+e,o=Math.floor(t.nDataCodewords/i),s=o+1),t.nBlockEcWords=u/i,t.blockDataLengths=[],a=0;r>a;a++)t.blockDataLengths[a]=o;for(a=r;i>a;a++)t.blockDataLengths[a]=s;for(t.blockIndices=[],a=0;i>a;a++)t.blockIndices[a]=[];for(n=0;o>n;n++)for(a=0;i>a;a++)t.blockIndices[a].push(g),g++;for(a=r;i>a;a++)t.blockIndices[a].push(g),g++;for(n=0;n<t.nBlockEcWords;n++)for(a=0;i>a;a++)t.blockIndices[a].push(g),g++},setFunctionalPattern:function(t){function i(t,i,r,e,o){var s,n;for(s=i;i+e>s;s++)for(n=r;r+o>n;n++)t.functionalPattern[s][n]=!0}function r(t,r){var e,o,s=r.alignmentPatterns[t.version].length;for(e=0;s>e;e++)for(o=0;s>o;o++)0===e&&0===o||0===e&&o===s-1||e===s-1&&0===o||i(t,r.alignmentPatterns[t.version][e]-2,r.alignmentPatterns[t.version][o]-2,5,5)}t.functionalPattern=[];var e,o;for(e=0;e<t.nModules;e++)for(t.functionalPattern[e]=[],o=0;o<t.nModules;o++)t.functionalPattern[e][o]=!1;i(t,0,0,9,9),i(t,t.nModules-8,0,8,9),i(t,0,t.nModules-8,9,8),i(t,8,6,t.nModules-8-8,1),i(t,6,8,1,t.nModules-8-8),r(t,this),t.version>=7&&(i(t,0,t.nModules-11,6,3),i(t,t.nModules-11,0,3,6))},nCountBits:function(t,i){return t===this.MODE.EightBit?10>i?8:16:t===this.MODE.AlphaNumeric?10>i?9:27>i?11:13:t===this.MODE.Numeric?10>i?10:27>i?12:14:void this.errorThrow("Internal error: Unknown mode: "+t)},nModulesFromVersion:function(t){return 17+4*t},unicodeToUtf8:function(t){var i,r,e="",o=t.length;for(i=0;o>i;i++)r=t.charCodeAt(i),r>=1&&127>=r?e+=t.charAt(i):r>2047?(e+=String.fromCharCode(224|r>>12&15),e+=String.fromCharCode(128|r>>6&63),e+=String.fromCharCode(128|r>>0&63)):(e+=String.fromCharCode(192|r>>6&31),e+=String.fromCharCode(128|r>>0&63));return e},utf8Tounicode:function(t){for(var i,r,e,o,s="",n=t.length,a=0;n>a;)r=t.charCodeAt(a++),i=r>>4,7>=i?s+=t.charAt(a-1):12===i||13===i?(e=t.charCodeAt(a++),s+=String.fromCharCode((31&r)<<6|63&e)):14===i&&(e=t.charCodeAt(a++),o=t.charCodeAt(a++),s+=String.fromCharCode((15&r)<<12|(63&e)<<6|(63&o)<<0));return s},setErrorThrow:function(t){"function"==typeof t&&(this._errorThrow=t)},alignmentPatterns:[null,[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],versionInfo:[null,null,null,null,null,null,null,31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017],formatInfo:[21522,20773,24188,23371,17913,16590,20375,19104,30660,29427,32170,30877,26159,25368,27713,26998,5769,5054,7399,6608,1890,597,3340,2107,13663,12392,16177,14854,9396,8579,11994,11245],nCodewords:[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706],nECCodewords:[null,[10,7,17,13],[16,10,28,22],[26,15,44,36],[36,20,64,52],[48,26,88,72],[64,36,112,96],[72,40,130,108],[88,48,156,132],[110,60,192,160],[130,72,224,192],[150,80,264,224],[176,96,308,260],[198,104,352,288],[216,120,384,320],[240,132,432,360],[280,144,480,408],[308,168,532,448],[338,180,588,504],[364,196,650,546],[416,224,700,600],[442,224,750,644],[476,252,816,690],[504,270,900,750],[560,300,960,810],[588,312,1050,870],[644,336,1110,952],[700,360,1200,1020],[728,390,1260,1050],[784,420,1350,1140],[812,450,1440,1200],[868,480,1530,1290],[924,510,1620,1350],[980,540,1710,1440],[1036,570,1800,1530],[1064,570,1890,1590],[1120,600,1980,1680],[1204,630,2100,1770],[1260,660,2220,1860],[1316,720,2310,1950],[1372,750,2430,2040]],ECBlocks:[[],[[1],[1],[1],[1]],[[1],[1],[1],[1]],[[1],[1],[2],[2]],[[2],[1],[4],[2]],[[2],[1],[2,2],[2,2]],[[4],[2],[4],[4]],[[4],[2],[4,1],[2,4]],[[2,2],[2],[4,2],[4,2]],[[3,2],[2],[4,4],[4,4]],[[4,1],[2,2],[6,2],[6,2]],[[1,4],[4],[3,8],[4,4]],[[6,2],[2,2],[7,4],[4,6]],[[8,1],[4],[12,4],[8,4]],[[4,5],[3,1],[11,5],[11,5]],[[5,5],[5,1],[11,7],[5,7]],[[7,3],[5,1],[3,13],[15,2]],[[10,1],[1,5],[2,17],[1,15]],[[9,4],[5,1],[2,19],[17,1]],[[3,11],[3,4],[9,16],[17,4]],[[3,13],[3,5],[15,10],[15,5]],[[17],[4,4],[19,6],[17,6]],[[17],[2,7],[34],[7,16]],[[4,14],[4,5],[16,14],[11,14]],[[6,14],[6,4],[30,2],[11,16]],[[8,13],[8,4],[22,13],[7,22]],[[19,4],[10,2],[33,4],[28,6]],[[22,3],[8,4],[12,28],[8,26]],[[3,23],[3,10],[11,31],[4,31]],[[21,7],[7,7],[19,26],[1,37]],[[19,10],[5,10],[23,25],[15,25]],[[2,29],[13,3],[23,28],[42,1]],[[10,23],[17],[19,35],[10,35]],[[14,21],[17,1],[11,46],[29,19]],[[14,23],[13,6],[59,1],[44,7]],[[12,26],[12,7],[22,41],[39,14]],[[6,34],[6,14],[2,64],[46,10]],[[29,14],[17,4],[24,46],[49,10]],[[13,32],[4,18],[42,32],[48,14]],[[40,7],[20,4],[10,67],[43,22]],[[18,31],[19,6],[20,61],[34,34]]]};ReedSolomon.prototype={encode:function(t){null==this.gen_poly&&(this.gen_poly=this.genPoly(this.n_ec_bytes));var i,r=new Array(this.n_ec_bytes+1);for(i=0;i<this.n_ec_bytes+1;i++)r[i]=0;for(i=0;i<t.length;i++){var e,o=t[i]^r[this.n_ec_bytes-1];for(e=this.n_ec_bytes-1;e>0;e--)r[e]=r[e-1]^this.gmult(this.gen_poly[e],o);r[0]=this.gmult(this.gen_poly[0],o)}var s=[];for(i=this.n_ec_bytes-1;i>=0;i--)s.push(r[i]);return s},decode:function(t){this.bytes_in=t,this.bytes_out=t.slice();var i=this.calculateSyndroms();return i>0?this.correctErrors():this.corrected=!0,this.bytes_out.slice(0,this.bytes_out.length-this.n_ec_bytes)},genPoly:function(t){var i,r,e;r=this.zeroPoly(),r[0]=1;var o;for(o=0;t>o;o++)i=this.zeroPoly(),i[0]=this.gexp[o],i[1]=1,e=this.multPolys(i,r),r=this.copyPoly(e);return this.logger&&this.logger.debug("RS genPoly: "+e.join(",")),e},calculateSyndroms:function(){this.syndroms=[];var t,i,r,e=0;for(r=0;r<this.n_ec_bytes;r++){for(t=0,i=0;i<this.bytes_in.length;i++)t=this.bytes_in[i]^this.gmult(this.gexp[r],t);this.syndroms.push(t),t>0&&e++}return this.logger&&this.logger.debug(e>0?"RS calculateSyndroms: <b>Errors found!</b> syndroms = "+this.syndroms.join(","):"RS calculateSyndroms: <b>No errors</b>"),e},correctErrors:function(){if(this.berlekampMassey(),this.findRoots(),this.corrected=!1,2*this.n_errors>this.n_ec_bytes)return this.uncorrected_reason="too many errors",void(this.logger&&this.logger.debug("RS correctErrors: <b>"+this.uncorrected_reason+"</b>"));var t;for(t=0;t<this.n_errors;t++)if(this.error_locs[t]>=this.bytes_in.length)return this.uncorrected_reason="corrections out of scope",void(this.logger&&this.logger.debug("RS correctErrors: <b>"+this.uncorrected_reason+"</b>"));if(0===this.n_errors)return this.uncorrected_reason="could not identify errors",void(this.logger&&this.logger.debug("RS correctErrors: <b>"+this.uncorrected_reason+"</b>"));var i;for(i=0;i<this.n_errors;i++){var r,e=this.error_locs[i],o=0;for(r=0;r<this.n_degree_max;r++)o^=this.gmult(this.omega[r],this.gexp[(255-e)*r%255]);var s=0;for(r=0;r<this.n_degree_max;r+=2)s^=this.gmult(this.psi[r],this.gexp[(255-e)*r%255]);var n=this.gmult(o,this.ginv(s));this.logger&&this.logger.debug("RS correctErrors: loc="+(this.bytes_out.length-e-1)+"  err = 0x0"+n.toString(16)+" = bin "+n.toString(2)),this.bytes_out[this.bytes_out.length-e-1]^=n}this.corrected=!0},berlekampMassey:function(){var t=this.zeroPoly();t[0]=1;var i=this.copyPoly(t);this.mulZPoly(i),this.psi=this.copyPoly(t);var r,e,o=new Array(this.n_degree_max),s=-1,n=0;for(e=0;e<this.n_ec_bytes;e++){var a=this.computeDiscrepancy(this.psi,this.syndroms,n,e);if(0!==a){for(r=0;r<this.n_degree_max;r++)o[r]=this.psi[r]^this.gmult(a,i[r]);if(e-s>n){var h=e-s;for(s=e-n,r=0;r<this.n_degree_max;r++)i[r]=this.gmult(this.psi[r],this.ginv(a));n=h}this.psi=this.copyPoly(o)}this.mulZPoly(i)}this.logger&&this.logger.debug("RS berlekampMassey: psi = "+this.psi.join(","));var u=this.multPolys(this.psi,this.syndroms);for(this.omega=this.zeroPoly(),r=0;r<this.n_ec_bytes;r++)this.omega[r]=u[r];this.logger&&this.logger.debug("RS berlekampMassey: omega = "+this.omega.join(","))},findRoots:function(){this.n_errors=0,this.error_locs=[];var t,i;for(i=1;256>i;i++){t=0;var r;for(r=0;r<this.n_ec_bytes+1;r++)t^=this.gmult(this.gexp[r*i%255],this.psi[r]);0===t&&(this.error_locs.push(255-i),this.n_errors++)}this.logger&&this.logger.debug("RS findRoots: errors=<b>"+this.n_errors+"</b> locations = "+this.error_locs.join(","))},computeDiscrepancy:function(t,i,r,e){var o,s=0;for(o=0;r>=o;o++)s^=this.gmult(t[o],i[e-o]);return s},copyPoly:function(t){var i,r=new Array(this.n_degree_max);for(i=0;i<this.n_degree_max;i++)r[i]=t[i];return r},zeroPoly:function(){var t,i=new Array(this.n_degree_max);for(t=0;t<this.n_degree_max;t++)i[t]=0;return i},mulZPoly:function(t){var i;for(i=this.n_degree_max-1;i>0;i--)t[i]=t[i-1];t[0]=0},multPolys:function(t,i){var r,e=new Array(this.n_degree_max),o=new Array(2*this.n_degree_max);for(r=0;r<2*this.n_degree_max;r++)e[r]=0;for(r=0;r<this.n_degree_max;r++){var s;for(s=this.n_degree_max;s<2*this.n_degree_max;s++)o[s]=0;for(s=0;s<this.n_degree_max;s++)o[s]=this.gmult(i[s],t[r]);for(s=2*this.n_degree_max-1;s>=r;s--)o[s]=o[s-r];for(s=0;r>s;s++)o[s]=0;for(s=0;s<2*this.n_degree_max;s++)e[s]^=o[s]}return e},initGaloisTables:function(){var t=0,i=1,r=0,e=0,o=0,s=0,n=0,a=0,h=0;this.gexp=new Array(512),this.glog=new Array(256),this.gexp[0]=1,this.gexp[255]=this.gexp[0],this.glog[0]=0;var u;for(u=1;256>u;u++)t=h,h=a,a=n,n=s,s=o^t,o=e^t,e=r^t,r=i,i=t,this.gexp[u]=i+2*r+4*e+8*o+16*s+32*n+64*a+128*h,this.gexp[u+255]=this.gexp[u];for(u=1;256>u;u++){var c;for(c=0;256>c;c++)if(this.gexp[c]===u){this.glog[u]=c;break}}},gmult:function(t,i){if(0===t||0===i)return 0;var r=this.glog[t],e=this.glog[i];return this.gexp[r+e]},ginv:function(t){return this.gexp[255-this.glog[t]]}},QRDecode.prototype={decodePix:function(t){return this.decodeImage(t)},decodeImageData:function(t,i,r){return this.setImageData(t,i,r),this.decode()},decodeImageDataInsideBordersWithMaxVersion:function(t,i,r,e,o,s,n,a){return this.setImageData(t,i,r),this.imageLeft=e,this.imageRight=o,this.imageTop=s,this.imageBottom=n,this.imageSize=(this.imageRight-this.imageLeft+1+(this.imageBottom-this.imageTop+1))/2,this.maxVersion=a,this.decodeInsideBordersWithMaxVersion()},setImageData:function(t,i,r){t.minCol=255,t.maxCol=0;var e,o,s,n,a=0;for(e=0;i>e;e++)for(o=0;r>o;o++)s=4*e+o*i*4,n=.3*t.data[s]+.59*t.data[s+1]+.11*t.data[s+2],a+=n,n<t.minCol&&(t.minCol=n),n>t.maxCol&&(t.maxCol=n);if(t.maxCol-t.minCol<25.5)throw"Image does not have enough contrast (this.image_data.min_col="+t.minCol+" this.image_data.max_col="+t.maxCol+")";t.threshold=a/(i*r),t.getGray=function(t,i,r){var e,o,s,n=0;for(e=t;t+r>e;e++)for(o=i;i+r>o;o++)s=4*e+o*this.width*4,n=n+.3*this.data[s]+.59*this.data[s+1]+.11*this.data[s+2];return n/r/r},t.isDark=function(t,i,r){var e=this.getGray(t,i,r);return e<this.threshold},this.image=t},decodeImage:function(t){return this.image=t,this.decode()},decode:function(){return this.findImageBorders(),this.maxVersion=40,this.decodeInsideBordersWithMaxVersion(),this.data},decodeInsideBordersWithMaxVersion:function(){return this.findModuleSize(),QRBase.setFunctionalPattern(this),this.extractCodewords(),QRBase.setBlocks(this),this.correctErrors(),this.extractData(),this.data},findImageBorders:function(){var t,i,r,e=7,o=2;for(t=0;t<this.image.width;t++){for(r=0,i=0;i<this.image.height;i++)r+=this.image.isDark(t,i,1);if(r>=e)break}for(this.imageLeft=t,t=this.image.width-1;t>=0;t--){for(r=0,i=0;i<this.image.height;i++)r+=this.image.isDark(t,i,1);if(r>=e)break}for(this.imageRight=t,i=0;i<this.image.height;i++){for(r=0,t=0;t<this.image.width;t++)r+=this.image.isDark(t,i,1);if(r>=e)break}for(this.imageTop=i,i=this.image.height-1;i>=0;i--){for(r=0,t=0;t<this.image.width;t++)r+=this.image.isDark(t,i,1);if(r>=e)break}if(this.imageBottom=i,this.imageRight-this.imageLeft+1<21||this.imageBottom-this.imageTop+1<21)throw"Found no image data to decode";if(Math.abs(this.imageRight-this.imageLeft-(this.imageBottom-this.imageTop))>o)throw"Image data is not rectangular";this.imageSize=(this.imageRight-this.imageLeft+1+(this.imageBottom-this.imageTop+1))/2},findModuleSize:function(){function t(t,i,r,e,o,s){var n,a,h=0;for(n=0;5>=n;n++)t.isDarkWithSize(i+n,r,s)&&(h+=1),t.isDarkWithSize(i+6,r+n,s)&&(h+=1),t.isDarkWithSize(i+6-n,r+6,s)&&(h+=1),t.isDarkWithSize(i,r+6-n,s)&&(h+=1);for(n=0;3>=n;n++)t.isDarkWithSize(i+n+1,r+1,s)||(h+=1),t.isDarkWithSize(i+5,r+n+1,s)||(h+=1),t.isDarkWithSize(i+5-n,r+5,s)||(h+=1),t.isDarkWithSize(i+1,r+5-n,s)||(h+=1);for(n=0;2>=n;n++)for(a=0;2>=a;a++)t.isDarkWithSize(3+i,3+r,s)&&(h+=1);for(n=0;6>=n;n++)t.isDarkWithSize(i+e,r+n,s)||(h+=1),t.isDarkWithSize(i+n,r+o,s)||(h+=1);return t.isDarkWithSize(i+e,r+o,s)||(h+=1),h}function i(t,i,r,e){var o,s,n,a,h,u=0,c=6,g=8,d=0,f=1,l=5,m=[],_=!0;for(i&&(c=8,g=6,d=1,f=0),o=0;l>o;o++)m.push(1);for(s=0;r-8-8>s;s++){for(n=c+s*d,a=g+s*f,_===t.isDarkWithSize(n,a,e)?(u++,m.push(1)):m.push(0),_=!_,h=0,o=m.length-l;o<m.length-1;o++)m[o]&&(h+=1);if(3>h)return 0}return u}function r(t,i,r,e){var o,s=0;for(o=0;3>=o;o++)t.isDarkWithSize(i+o,r,e)&&(s+=1),t.isDarkWithSize(i+4,r+o,e)&&(s+=1),t.isDarkWithSize(i+4-o,r+4,e)&&(s+=1),t.isDarkWithSize(i,r+4-o,e)&&(s+=1);for(o=0;1>=o;o++)t.isDarkWithSize(i+o+1,r+1,e)||(s+=1),t.isDarkWithSize(i+3,r+o+1,e)||(s+=1),t.isDarkWithSize(i+3-o,r+3,e)||(s+=1),t.isDarkWithSize(i+1,r+3-o,e)||(s+=1);return t.isDarkWithSize(i+2,r+2,e)&&(s+=1),s}function e(t,i,e){var o,s,n,a=0,h=QRBase.alignmentPatterns[i].length;for(o=0;h>o;o++)for(s=0;h>s;s++)0===o&&0===s||0===o&&s===h-1||o===h-1&&0===s||(n=r(t,QRBase.alignmentPatterns[i][o]-2,QRBase.alignmentPatterns[i][s]-2,e),n>24&&a++);return a}function o(t,i){var r,e;for(r=7;40>=r;r++)if(e=t.hammingDistance(i,QRBase.versionInfo[r]),3>=e)return[r,e];return[0,4]}function s(t,i,r){var e,s,n=1,a=0;for(s=0;6>s;s++)for(e=i-11;i-11+3>e;e++)t.isDarkWithSize(e,s,r)&&(a+=n),n*=2;return o(t,a)}function n(t,i,r){var e,s,n=1,a=0;for(e=0;6>e;e++)for(s=i-11;i-11+3>s;s++)t.isDarkWithSize(e,s,r)&&(a+=n),n*=2;return o(t,a)}function a(t,i){var r,e;for(r=0;32>r;r++)if(e=t.hammingDistance(i,QRBase.formatInfo[r]),3>=e)return[r,e];return[0,4]}function h(t,i,r){var e,o=1,s=0,n=8;for(e=0;5>=e;e++)t.isDarkWithSize(n,e,r)&&(s+=o),o*=2;for(t.isDarkWithSize(8,7,r)&&(s+=o),o*=2,t.isDarkWithSize(8,8,r)&&(s+=o),o*=2,t.isDarkWithSize(7,8,r)&&(s+=o),o*=2,e=8,n=5;n>=0;n--)t.isDarkWithSize(n,e,r)&&(s+=o),o*=2;return a(t,s)}function u(t,i,r){var e,o=1,s=0,n=8;for(e=i-1;e>i-1-8;e--)t.isDarkWithSize(e,n,r)&&(s+=o),o*=2;for(e=8,n=i-7;i-1>n;n++)t.isDarkWithSize(e,n,r)&&(s+=o),o*=2;return a(t,s)}function c(t){var i,r=4;for(i=0;3>i;i++)r-=64-t[i];return 0>r&&(r=0),r}function g(t,i){var r=(t[0]+t[1])/(2*i);return r=1-r,r>=.14?0:r>=.11?1:r>=.07?2:r>=1e-5?3:4}function d(t,i){var r=t/i;return r=1-r,r>=.3?0:r>=.2?1:r>=.1?2:r>=1e-5?3:4}function f(r,o){var a,f,l,m,_,b,v,y=[],p=QRBase.nModulesFromVersion(o),k=r.imageSize/p,x=[0,0,0],D=[0,0],S=[0,0],C=[0,0],I=-3,M=0,R=4;if(x[0]=t(r,0,0,7,7,k),x[0]<61)return[o,0];if(x[1]=t(r,0,p-7,7,-1,k),x[0]+x[1]<125)return[o,0];if(x[2]=t(r,p-7,0,-1,7,k),a=c(x),1>a)return[o,0];if(y.push(a),o>=7){if(D=s(r,p,k),S=n(r,p,k),f=o,D[1]<S[1]?D[1]<4&&(f=D[0]):S[1]<4&&(f=S[0]),f!==o&&(o=f),p=QRBase.nModulesFromVersion(o),k=r.imageSize/p,a=Math.round((4-D[1]+(4-S[1]))/2),1>a)return[o,0];y.push(a)}if(C[0]=i(r,!0,p,k),C[1]=i(r,!1,p,k),a=g(C,p-8-8),1>a)return[o,0];if(y.push(a),o>1&&(I=e(r,o,k)),a=d(I,QRBase.alignmentPatterns[o].length*QRBase.alignmentPatterns[o].length-3),1>a)return[o,0];if(y.push(a),l=h(r,p,k),m=u(r,p,k),M=l[1]<m[1]?l[0]:m[0],_=Math.floor(M/8),b=M%8,a=Math.round((4-l[1]+(4-m[1]))/2),1>a)return[o,0];for(y.push(a),v=0;v<y.length;v++)y[v]<R&&(R=y[v]);return[o,R,_,b]}var l,m,_=[0,0];for(l=1;l<=this.maxVersion&&(m=f(this,l),m[1]>_[1]&&(_=m),4!==m[1]);l++);if(this.version=_[0],this.nModules=QRBase.nModulesFromVersion(this.version),this.moduleSize=this.imageSize/this.nModules,this.functionalGrade=_[1],this.ECLevel=_[2],this.mask=_[3],this.functionalGrade<1)throw"Unable to decode a function pattern"},extractCodewords:function(){function t(t,i,r){var e,o;switch(t.mask){case 0:e=(r+i)%2;break;case 1:e=r%2;break;case 2:e=i%3;break;case 3:e=(r+i)%3;break;case 4:e=(Math.floor(r/2)+Math.floor(i/3))%2;break;case 5:e=r*i%2+r*i%3;break;case 6:e=(r*i%2+r*i%3)%2;break;case 7:e=((r+i)%2+r*i%3)%2}return o=0===e?!t.isDark(i,r):t.isDark(i,r)}this.codewords=[];var i,r,e,o,s=!0,n=0,a=128,h=0;for(r=this.nModules-1;r>0;r-=2){for(6===r&&r--,o=0;o<this.nModules;o++)for(i=s?this.nModules-1-o:o,e=0;2>e;e++)this.functionalPattern[r-e][i]||(t(this,r-e,i)&&(n+=a),a/=2,1>a&&(this.codewords.push(n),h=0,a=128,n=0));s^=!0}},extractData:function(){function t(t,i,r,e){var o=24-(7&r)-e,s=(1<<e)-1,n=r>>>3;return(i[n]<<16|i[++n]<<8|i[++n])>>o&s}function i(i,r){var e,o,s=QRBase.nCountBits(QRBase.MODE.EightBit,i.version),n=t(i,r,i.bitIdx,s),a="";for(i.bitIdx+=s,e=0;n>e;e++)o=t(i,r,i.bitIdx,8),a+=String.fromCharCode(o),i.bitIdx+=8;return QRBase.utf8Tounicode(a)}function r(i,r){var e,o,s=QRBase.nCountBits(QRBase.MODE.AlphaNumeric,i.version),n=t(i,r,i.bitIdx,s),a="";for(i.bitIdx+=s,e=0;e<Math.floor(n/2);e++)o=t(i,r,i.bitIdx,11),a+=i.alphanum[Math.floor(o/45)],a+=i.alphanum[o%45],i.bitIdx+=11;return n%2&&(a+=i.alphanum[t(i,r,i.bitIdx,6)],i.bitIdx+=6),a}function e(i,r){var e,o,s,n,a,h=QRBase.nCountBits(QRBase.MODE.Numeric,i.version),u=t(i,r,i.bitIdx,h),c="";for(i.bitIdx+=h,a=0;a<Math.floor(u/3);a++)e=t(i,r,i.bitIdx,10),i.bitIdx+=10,o=Math.floor(e/100),s=Math.floor(e%100/10),n=e%10,c+=String.fromCharCode(48+o,48+s,48+n);return u%3===1?(e=t(i,r,i.bitIdx,4),i.bitIdx+=4,c+=String.fromCharCode(48+e)):u%3===2&&(e=t(i,r,i.bitIdx,7),i.bitIdx+=7,o=Math.floor(e/10),s=e%10,c+=String.fromCharCode(48+o,48+s)),c}var o,s,n=this.bytes,a=8*n.length;for(o=0;4>o;o++)n.push(0);for(this.data="",this.bitIdx=0;this.bitIdx<a-4&&(s=t(this,n,this.bitIdx,4),this.bitIdx+=4,s!==QRBase.MODE.Terminator);)if(s===QRBase.MODE.AlphaNumeric)this.data+=r(this,n);else if(s===QRBase.MODE.EightBit)this.data+=i(this,n);else{if(s!==QRBase.MODE.Numeric)throw"Unsupported ECI mode: "+s;this.data+=e(this,n)}},correctErrors:function(){var t,i,r,e,o=new ReedSolomon(this.nBlockEcWords),s=[],n=[];for(t=0;t<this.blockIndices.length;t++){for(i=[],e=0;e<this.blockIndices[t].length;e++)i.push(this.codewords[this.blockIndices[t][e]]);if(r=o.decode(i),!o.corrected)throw this.errorGrade=0,"Unable to correct errors ("+o.uncorrected_reason+")";n=n.concat(r),s.push(o.n_errors)}this.errors=s,this.bytes=n,this.errorGrade=this.gradeErrors(s)},gradeErrors:function(t){var i,r=this.nBlockEcWords,e=0,o=4;for(i=0;i<t.length;i++)t[i]>e&&(e=t[i]);return e>r/2-1?o=0:e>r/2-2?o=1:e>r/2-3?o=2:e>r/2-4&&(o=3),o},hammingDistance:function(t,i){function r(t){var i;for(i=0;t;i++)t&=t-1;return i}var e=t^i;return r(e)},isDarkWithSize:function(t,i,r){return this.image.isDark(Math.round(this.imageLeft+t*r),Math.round(this.imageTop+i*r),Math.round(r))},isDark:function(t,i){return this.isDarkWithSize(t,i,this.moduleSize)},alphanum:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"]},function(t,i,r,e){var o=function(i){var r,e=this;e.text="",t.extend(e,{_init:function(t){var i=new QRDecode,r=i.decodeImageData(t,e.width,e.height);return r},getImageData:function(i){var r;if("canvas"!==i.nodeName.toLowerCase()){if(!t(i).find("canvas").length)return!1;i=t(i).find("canvas")[0]}return r=i.getContext("2d"),e.width=i.width,e.height=i.height,r.getImageData(0,0,i.width,i.height)}}),r=e.getImageData(i),r&&(e.text=e._init(r))};t.fn.qrdecode=function(){var i=t(this),r=i.length,e="";return r&&(e=new o(i[0]).text),e}}(jQuery,window,document);